!function(t){var e={};function i(o){if(e[o])return e[o].exports;var n=e[o]={i:o,l:!1,exports:{}};return t[o].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=t,i.c=e,i.d=function(t,e,o){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(i.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(o,n,function(e){return t[e]}.bind(null,n));return o},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="/codebase/",i(i.s=4)}([function(t,e,i){"use strict";function o(t){return Array.isArray?Array.isArray(t):"[object Array]"===Object.prototype.toString.call(t)}function n(t){return void 0===t}function r(t,e,i){for(var o in e)t[o]&&!i||(t[o]=e[o]);return t}var a;function s(){return a||(a=(new Date).valueOf()),++a}i.d(e,"b",function(){return o}),i.d(e,"c",function(){return n}),i.d(e,"a",function(){return r}),i.d(e,"d",function(){return s})},function(t,e,i){"use strict";i.d(e,"c",function(){return s}),i.d(e,"b",function(){return l}),i.d(e,"a",function(){return u});var o=i(0),n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};function r(t,e,i){if("object"==(void 0===t?"undefined":n(t))){for(var o=0;o<t.length;o++)if(t[o]=parseFloat(t[o]),isNaN(t[o]))return!0}else if(t=parseFloat(t),isNaN(t))return!0;return!isNaN(e)&&i(t,e)}var a={contains:function(t,e){return e.toLowerCase().indexOf(t.toString().toLowerCase())>=0},equal:function(t,e){return r(t,e,function(t,e){return t==e})},not_equal:function(t,e){return r(t,e,function(t,e){return t!=e})},less:function(t,e){return r(t,e,function(t,e){return e<t})},less_equal:function(t,e){return r(t,e,function(t,e){return e<=t})},more:function(t,e){return r(t,e,function(t,e){return e>t})},more_equal:function(t,e){return r(t,e,function(t,e){return e>=t})},multi:function(t,e){"string"==typeof t&&(t=t.split(","));for(var i=0;i<t.length;i++)if(e==t[i])return!0;return!1},range:function(t,e){return r(t,e,function(t,e){return e<t[1]&&e>=t[0]})},range_inc:function(t,e){return r(t,e,function(t,e){return e<=t[1]&&e>=t[0]})}};function s(t){t=t||[];for(var e=0;e<t.length;e++){var i=t[e],o=i.fvalue;"function"==typeof o?i.func=o:"select"==i.type||"richselect"==i.type?(i.func=function(t,e){return t==e},o=o||""):i.type.indexOf("multi")>-1?i.func=a.multi:"object"===(void 0===o?"undefined":n(o))?i.func=a.range:"="==o.substr(0,1)?(i.func=a.equal,o=o.substr(1)):"<>"==o.substr(0,2)?(i.func=a.not_equal,o=o.substr(2)):">="==o.substr(0,2)?(i.func=a.more_equal,o=o.substr(2)):">"==o.substr(0,1)?(i.func=a.more,o=o.substr(1)):"<="==o.substr(0,2)?(i.func=a.less_equal,o=o.substr(2)):"<"==o.substr(0,1)?(i.func=a.less,o=o.substr(1)):o.indexOf("...")>0?(i.func=a.range,o=o.split("...")):o.indexOf("..")>0?(i.func=a.range_inc,o=o.split("..")):"datepicker"==i.type?i.func=function(t,e){return t==e}:i.func=a.contains,i.fvalue=o}}function l(t){var e,i;for(t=t||[],e=0;e<t.length;e++)"string"==typeof(i=t[e].fvalue||t[e].value||"")&&i.trim&&(i=i.trim()),t[e].fvalue=i}function u(t,e,i){if(t){var n=void 0,r=void 0;for(n=0;n<t.length;n++)if((r=t[n]).fvalue){var a=i&&i[r.name]?i[r.name]:r.name;if(o.c(e[a]))return!1;var s=e[a];if(0!==!s&&!s)return!1;var l=s.toString();if(!r.func(r.fvalue,l))return!1}}return!0}},function(t,e,i){"use strict";var o=i(0);function n(t,e){return"$webixtotal"+t.$divider+e}function r(t,e){var i,o,n=[];for(i=0;i<e.length;i++)o=t[e[i]],isNaN(parseFloat(o))||n.push(o);return n}var a={dir:1,as:function(t,e){return u(t)&&u(e)?s.int(t,e):s.string(t,e)}},s={date:function(t,e){return(t-=0)>(e-=0)?1:t<e?-1:0},int:function(t,e){return(t*=1)>(e*=1)?1:t<e?-1:0},string:function(t,e){return e?t?(t=t.toString().toLowerCase())>(e=e.toString().toLowerCase())?1:t<e?-1:0:-1:1}};function l(t,e){var i,r,s,l,u=t.config.structure.values;for(e=function t(e,i){var o,n,r,a,s,l=[];for(n=0;n<i.length;n++)if((r=i[n]).data.length){var u=t(e,r.data);for(o=!1,a=0;a<u.length;a++)(s=u[a]).splice(0,0,{name:r.key}),o||(s[0].colspan=u.length,o=!0),l.push(s)}else{var c=i[n].key.split(e.$divider);l.push([{name:i[n].key,operation:c[0],text:c[1]}])}return l}(t,e=function t(e,i,n){var r,s,l,u,c,p=[];if(Object.keys&&!1!==e.columnSort)for(n=n||0,r=e.columns[n],c=function(t,e){var i=a;t&&(t[e]?i=t[e]:t.$default&&(i=t.$default),i.dir&&(i._dir="desc"==i.dir?-1:1),o.a(i,a));return i}(e.columnSort,r),u=Object.keys(i),n<e.columns.length&&(u=u.sort(function(t,e){return c.as(t,e)*c._dir})),n++,s=0;s<u.length;s++)l=u[s],p.push({key:l,data:t(e,i[l],n)});else for(l in i)p.push({key:l,data:t(e,i[l])});return p}(t.config.structure,e)),i=0;i<e.length;i++){var c=[];for(r=0;r<e[i].length;r++)c.push(e[i][r].name);l=null;var p=c[c.length-1].split(t.$divider);for(r=0;r<u.length&&!l;r++)if(u[r].operation)for(s=0;s<u[r].operation.length;s++)u[r].name==p[1]&&u[r].operation[s]==p[0]&&(l=u[r]);e[i]={id:c.join(t.$divider),header:e[i]},e[i].format=l&&l.format?l.format:"count"!=p[0]?t.config.format:null}return e.length&&t.view&&t.view.callEvent&&t.view.callEvent("onHeaderInit",[e]),t.config.totalColumn&&e.length&&(e=function(t,e){var i,o,r,a,s,l,u,c=[];if((l=e[0].header.length)<2)return e;for(r in o=function(t,e){var i,o,n,r,a,s={},l=0;for(o=0;o<e.length;o++)a=e[o].id.split(t.$divider),n=a.pop(),"sum"!=(r=a.pop())&&"sumOnly"==t.config.totalColumn||(i=r+t.$divider+n,s[i]||(l++,s[i]={operation:r,ids:[],format:e.format}),s[i].ids.push(e[o].id));return{groups:s,count:l}}(t,e),i=o.groups,t._pivotColumnGroups=i,i){for(a={id:n(t,r),header:[],sort:"int",width:t.config.columnWidth,format:t.config.format},s=0;s<l-1;s++)s||c.length?a.header.push(""):a.header.push({name:"total",rowspan:l-1,colspan:o.count});u=r.split(t.$divider),a.header.push({name:r,operation:u[0],text:u[1]}),c.push(a)}return e.concat(c)}(t,e)),e.splice(0,0,{id:"name",template:"{common.treetable()} #name#",header:{text:void 0}}),e}function u(t){return!isNaN(1*t)}var c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};function p(t,e,i,o){var n,r,a=[],s=[];for(t=function t(e,i,o){o||(o=[]);for(var n=0;n<e.length;n++)i&&e[n].data?t(e[n].data,i,o):o.push(e[n]);return o}(t,o),n=0;n<t.length;n++)r=t[n][e],isNaN(parseFloat(r))||(s.push(1*r),a.push(t[n]));return i(s,e,a)}var h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};function f(t,e,i){var o;for(o=0;o<t.length;o++)t[o].data?f(t[o].data,e,i):i.push(t[o][e])}var d=i(1),v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},g=function(){function t(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,i,o){return i&&t(e.prototype,i),o&&t(e,o),e}}();var _=function(){function t(e,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.master=e,this.config=i,this.count=0}return t.prototype.process=function(t,e){var i,a,s,u,h;this.watch=new Date;var f=this.structure;for(f._header=[],f._header_hash={},d.b(f.filters),d.c(f.filters),u=0;u<f.values.length;u++)f.values[u].operation=f.values[u].operation||["sum"],o.b(f.values[u].operation)||(f.values[u].operation=[f.values[u].operation]);for(i=[],u=0;u<f.columns.length;u++)i[u]="object"==v(f.columns[u])?f.columns[u].id||u:f.columns[u];return a=f.rows.concat(i),h=this.group(t,e,a),s={},f.rows.length>0?h=this.processRows(h,f.rows,f,s,""):(this.processColumns(h,i,f,s),h=[]),s=l(this.master,s),h=function t(e,i){var o=e._pivotColumnGroups;if(o){var a=void 0,s=void 0,l=void 0;for(l in o)for(s=o[l].ids,a=0;a<i.length;a++){var u=void 0,c=n(e,l),p="",h=r(i[a],s);h.length&&(u=e._pivotOperations.getTotal(l.split(e.$divider)[0]))&&(p=u.call(e,h,c,i[a])),i[a][c]=p,i[a].data&&(i[a].data=t(e,i[a].data))}}return i}(this.master,h),this.config.footer&&function(t,e,i){var n,r,a,s;for(r=1;r<e.length;r++){n=null,s=(a=e[r].id.split(t.$divider))[a.length-2],"sumOnly"==t.config.footer&&"sum"!=s&&(n=" ");var l=t._pivotOperations.getTotal(s);if(!n&&l){var u=t._pivotOperations.getTotalOptions(s);n={$pivotValue:p(i,e[r].id,l,u&&u.leavesOnly),$pivotOperation:s}}else n=" ";e[r].footer=n,"object"==c(t.config.footer)&&o.a(e[r].footer,t.config.footer,!0)}}(this.master,s,h),delete f._header,delete f._header_hash,{header:s,data:h}},t.prototype.processColumns=function(t,e,i,n,r,a){var s;if(r=r||{$source:[]},e.length>0)for(var l in a=a||"",t)n[l]||(n[l]={}),t[l]=this.processColumns(t[l],e.slice(1),i,n[l],r,(a.length>0?a+this.divider:"")+l);else{var u=i.values;for(var c in t){r.$source.push(c);for(var p=0;p<u.length;p++)for(var h=0;h<u[p].operation.length;h++)s=void 0!==a?a+this.divider+u[p].operation[h]+this.divider+u[p].name:u[p].operation[h]+this.divider+u[p].name,i._header_hash[s]||(i._header.push(s),i._header_hash[s]=!0),o.c(r[s])&&(r[s]=[],n[u[p].operation[h]+this.divider+u[p].name]={}),r[s].push({value:t[c][u[p].name],id:c})}}return r},t.prototype.processRows=function(t,e,i,n,r){var a,s,l,u,c,p=[];if(e.length>1){for(a in t)t[a]=this.processRows(t[a],e.slice(1),i,n,r+"_"+a);var h=i._header;for(a in t){for(s={data:t[a]},l=0;l<s.data.length;l++)for(u=0;u<h.length;u++)c=h[u],o.c(s[c])&&(s[c]=[]),s[c].push(s.data[l][c]);this.setItemValues(s),this.master.config.stableRowId&&(s.id=r+"_"+a),s.name=a,s.open=!0,p.push(s)}}else for(a in t)(s=this.processColumns(t[a],i.columns,i,n)).name=a,this.master.config.stableRowId&&(s.id=r+"_"+a),this.setItemValues(s),p.push(s);return p},t.prototype.setItemValues=function(t){return t=function(t,e){var i,o,n,r,a,s,l,u,c=e.header,p=e.max,h=e.min,f=e.values;if(!h&&!p)return t;for(t.$cellCss||(t.$cellCss={}),i=0;i<f.length;i++){for(u=f[i],r=[],a=-99999999,s=[],l=99999999,o=0;o<c.length;o++)n=c[o],isNaN(t[n])||-1!==n.indexOf(u.name)&&(p&&t[n]>a?(r=[n],a=t[n]):t[n]==a&&r.push(n),h&&t[n]<l?(s=[n],l=t[n]):t[n]==l&&s.push(n));for(o=0;o<s.length;o++)t.$cellCss[s[o]]="webix_min";for(o=0;o<r.length;o++)t.$cellCss[r[o]]="webix_max"}return t}(t=function(t,e,i){var o,n,r,a,s,l,u,c=e.header;for(o=0;o<c.length;o++){if(s=(l=(r=c[o]).split(e.divider))[l.length-2],u=t[r],a=e.operations.getOption(s,"leavesOnly"),n=e.operations.getOption(s,"ids"),a&&t.data&&(u=[],f(t.data,r,u)),u){for(var p=[],d=[],v=0;v<u.length;v++){var g=u[v],_=null;"object"==(void 0===g?"undefined":h(g))&&(g=g.value,_=u[v].id),(g||"0"==g)&&(p.push(g),_&&d.push(_))}p.length?t[r]=e.operations.get(s)(p,r,t,n?d:null):t[r]=""}else t[r]="";i.count++}return t}(t,{header:this.structure._header,divider:this.divider,operations:this.operations},this),{header:this.structure._header,max:this.config.max,min:this.config.min,values:this.structure.values}),this.count>5e4&&(this.count=0,this.config.ping&&this.config.ping.call(this,this.watch)),t},t.prototype.group=function(t,e,i){var o,n,r={};for(o=0;o<e.length;o++)(n=t[e[o]])&&d.a(this.structure.filters,n,this.config.filterMap)&&this.groupItem(r,n,i);return r},t.prototype.groupItem=function(t,e,i){if(i.length){var n=e[i[0]];if(void 0===n)return null;o.c(t[n])&&(t[n]={}),this.groupItem(t[n],e,i.slice(1))}else t[e.id]=e},t.prototype.filterItem=function(t){for(var e=this.structure.filters||[],i=0;i<e.length;i++){var n=e[i];if(n.fvalue){if(o.c(t[n.name]))return!1;var r=t[n.name].toString().toLowerCase();if(!n.func(n.fvalue,r))return!1}}return!0},g(t,[{key:"operations",get:function(){return this.master._pivotOperations}},{key:"divider",get:function(){return this.master.$divider}},{key:"structure",get:function(){return this.config.structure}}]),t}(),b=i(3);i.d(e,"b",function(){return y}),i.d(e,"a",function(){return $});var w="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};function m(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var x="_'_",y=function(){function t(e,i){m(this,t),this.$divider=x,this._initOperations(),this.config=e,this.view=i,e.webWorker&&"undefined"!==!("undefined"==typeof Worker||w(Worker))&&i?this._initWorker(e,i):this._pivotData=new _(this,this.config),this.config.structure||(this.config.structure={}),o.a(this.config.structure,{rows:[],columns:[],values:[],filters:[]})}return t.prototype._initWorker=function(t,e){this._result=null,this._pivotWorker=new Worker(t.webWorker),this._pivotWorker.onmessage=function(t){"ping"===t.data.type?e._runPing(t.data.watch,e):e._result&&!e.$destructed&&(e.callEvent("onWebWorkerEnd",[]),t.data.id&&t.data.id!==e._result_id||(e._result(t.data.data),e._result=null))}},t.prototype._runPing=function(t,e){try{this.config.ping(t)}catch(t){this._pivotWorker.terminate(),this._initWorker(this.config,e),e.callEvent("onWebWorkerEnd",[])}},t.prototype._getPivotData=function(t,e,i){if(!this._pivotWorker){var o=this._pivotData.process(t,e);return i&&i(o),o}var n=this._result_id=webix.uid();this._result=i;var r=[],a=this.config.structure,s=this.config.footer,l=this._pivotOperations.serialize();if(a&&(a.rows.length||a.columns.length))for(var u=e.length-1;u>=0;u--)r[u]=t[e[u]];this.callEvent("onWebWorkerStart",[]);var c=this.config.format;if("function"==typeof c){var p="x"+webix.uid();webix.i18n[p]=c,c=p}var h=!!this.config.ping;this._pivotWorker.postMessage({footer:s,structure:a,data:r,id:n,operations:l,ping:h,format:c})},t.prototype._initOperations=function(){var t=this._pivotOperations=new b.a;this.operations=t.pull},t.prototype.addOperation=function(t,e,i){this._pivotOperations.add(t,e,i)},t.prototype.addTotalOperation=function(t,e,i){this._pivotOperations.addTotal(t,e,i)},t}(),$=function(t){function e(){return m(this,e),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.apply(this,arguments))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.getData=function(t){var e,i,n,r,a=[],s={},l=this.config.structure.filters,u={},c={},p={},h=this.operations,f=[],d={};for(e=0;e<l.length;e++)-1!=l[e].type.indexOf("select")&&(c[l[e].name]=[],p[l[e].name]={});for(e=0;e<t.length;e++){if(u[i=t[e].id=t[e].id||o.d()]=t[e],f.push(i),e<5)for(r in t[e])s[r]||(a.push(r),s[r]=o.d());for(n in c){var v=t[e][n];o.c(v)||p[n][v]||(p[n][v]=1,c[n].push(v))}}for(i in d.options=c,d.fields=a,d.data=this._getPivotData(u,f),d.operations=[],h)d.operations.push(i);return d},e}(y)},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",function(){return Operations});var _helpers_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(0);function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var operations={sum:function(t){for(var e=0,i=0;i<t.length;i++){var o=t[i];o=parseFloat(o,10),isNaN(o)||(e+=o)}return e},count:function(t,e,i){var o=0;if(i.data)for(var n=0;n<i.data.length;n++)o+=i.data[n][e]||0;else o=t.length;return o},max:function(t){return 1==t.length?t[0]:Math.max.apply(this,t)},min:function(t){return 1==t.length?t[0]:Math.min.apply(this,t)}},totalOperations={sum:function(t){var e,i=0;for(e=0;e<t.length;e++)i+=t[e];return i},min:function(t){return 1==t.length?t[0]:Math.min.apply(null,t)},max:function(t){return 1==t.length?t[0]:Math.max.apply(null,t)},count:function(t){var e=totalOperations.sum.call(this,t);return e?parseInt(e,10):""}},Operations=function(){function Operations(){_classCallCheck(this,Operations),this.pull=_helpers_js__WEBPACK_IMPORTED_MODULE_0__.a({},operations),this.options={},this.pullTotal=_helpers_js__WEBPACK_IMPORTED_MODULE_0__.a({},totalOperations),this.totalOptions={}}return Operations.prototype.serialize=function(){var t={};for(var e in this.pull)t[e]=this.pull[e].toString();return t},Operations.prototype.parse=function parse(str){for(var key in str)eval("this.temp = "+str[key]),this.pull[key]=this.temp},Operations.prototype.add=function(t,e,i){this.pull[t]=e,i&&(this.options[t]=i)},Operations.prototype.addTotal=function(t,e,i){this.pullTotal[t]=e,i&&(this.totalOptions[t]=i)},Operations.prototype.get=function(t){return this.pull[t]||null},Operations.prototype.getOptions=function(t){return this.options[t]||null},Operations.prototype.getOption=function(t,e){return this.options[t]?this.options[t][e]:null},Operations.prototype.getTotal=function(t){return this.pullTotal[t]||this.pull[t]||null},Operations.prototype.getTotalOptions=function(t){return this.pullTotal[t]?this.totalOptions[t]||null:this.options[t]||null},Operations.prototype.getTotalOption=function(t,e){var i=this.getTotalOptions(t);return i?i[t][e]:null},Operations}()},function(t,e,i){"use strict";i.r(e);i(9),i(7),i(6);function o(t){t=t||[];for(var e=0;e<t.length;e++)t[e].fvalue=n(t[e].value)}function n(t){return t=t||"",webix.isDate(t)?t=t.valueOf().toString():"string"==typeof t&&t.trim&&(t=t.trim()),t}function r(t){var e,i,o,n=t.config,r=n.structure.filters||[],s=[],l={};for(e=0;e<r.length;e++){i=r[e],webix.isUndefined(l[i.type])&&(l[i.type]=[]),l[i.type].push(e);var u="multiselect"===i.type?"multicombo":"select"===i.type?"richselect":i.type;if(o={value:webix.isUndefined(i.value)?"":i.value,point:!1,field:i.name,view:u,minWidth:n.filterMinWidth,maxWidth:n.filterWidth},n.filterPlaceholder&&("boolean"==typeof n.filterPlaceholder?(o.placeholder=o.label,o.label=""):o.placeholder=n.filterPlaceholder),"multicombo"==i.type&&(o.tagMode=!1),t.filters.isSelect(i.type)&&(o.options={},o.options.data=a(t,i.name,-1==i.type.indexOf("multi")),o.options.point=!1,"select"==i.type&&(o.options.css="webix_pivot_richselect_suggest"),"multicombo"==i.type&&(o.options.css="webix_pivot_multicombo_suggest")),n.separateLabel||(o.label=t._applyMap(i.name),o.labelAlign=n.filterLabelAlign,o.labelWidth=n.filterLabelWidth),t.callEvent("onFilterCreate",[i,o]))if(n.separateLabel){var c=t._applyMap(i.name);s.push({cols:[{view:"label",autowidth:!0,label:c},{width:10},o,{width:18}]})}else s.push(o)}return s}function a(t,e,i){var o,n=[],r=t.data.pull,a={};if(i&&n.push({value:"",id:"",$empty:!0}),t._pivotOptions&&t._pivotOptions[e])return n.concat(t._pivotOptions[e]);for(var s in r)o=r[s][e],webix.isUndefined(o)||!o&&0!==o||a[o]||(n.push({value:o.toString(),id:o.toString()}),a[o]=!0);var l=function(t){return!isNaN(parseFloat(t))};return n.sort(function(t,e){var i=t.value,o=e.value;return o?i?(l(i)&&l(o)||(i=i.toString().toLowerCase(),o=o.toString().toLowerCase()),i>o?1:i<o?-1:0):-1:1}),n}function s(t,e){!function(t,e){for(var i=0;i<e.length;i++){var o=void 0,n=e[i];n.cols&&(n=n.cols[2]),o="text"==n.view?"onTimedKeyPress":"onChange",n.on={},n.on[o]=function(){var e=this.getValue();e&&this.config.separator&&!this.format_setter&&(e=e.split(this.config.separator)),l(t,this.config.field,e)}}}(t,e);var i={elements:e};t.callEvent("onViewInit",["filters",i]),i.elements&&t.getFilterView()&&(e.length>0?(t.getFilterView().show(),webix.ui(e,t.getFilterView())):t.getFilterView().hide())}function l(t,e,i){for(var o=t.config.structure.filters,n=0;n<o.length;n++)if(o[n].name==e)return o[n].value=i,t.callEvent("onFilterChange",[e,i]),!0;return!1}var u={add:function(t,e){var i=this.$$("values").getItem(e);i.operation.push("sum"),this.$$("values").updateItem(e),webix.delay(function(){for(var t=i.operation.length-1,o=this.$$("values").getItemNode(e).childNodes,n=null,r=0;r<o.length;r++)if((n=o[r]).getAttribute){var a=n.getAttribute("webix_operation");if(!webix.isUndefined(a)&&a==t)break}null!==n&&u.selector.call(this,n,e,n)},this)},"filter-selector":function(t,e,i){var o,n=webix.$$(this.config.pivot),r={view:"webix_pivot_popup",css:"webix_pivot_popup",autofit:!0,autoheight:!0,width:150,data:c(n.filters.get(),n._applyLocale)};(o=webix.ui(r)).show(i),o.attachEvent("onHide",webix.bind(function(){var t=o.getSelected();if(null!==t){var i=this.$$("filters").getItem(e);i.type=t.name,i.value="",this.$$("filters").updateItem(e)}o.close()},this))},"chart-selector":function(t,e,i){var o,n=webix.$$(this.config.pivot),r={view:"webix_pivot_popup",css:"webix_pivot_popup",autofit:!0,autoheight:!0,width:150,data:c(n.filters.get(),n._applyLocale)};(o=webix.ui(r)).show(i),o.attachEvent("onHide",webix.bind(function(){var t=o.getSelected();if(null!==t){var i=this.$$("filters").getItem(e);i.type=t.name,i.value="",this.$$("filters").updateItem(e)}o.close()},this))},selector:function(t,e,i){var o={view:"webix_pivot_popup",css:"webix_pivot_popup",autofit:!0,width:150,data:this.config.operations||[]},n=webix.ui(o);n.show(i),n.attachEvent("onHide",webix.bind(function(){var i=webix.html.locate(t,"webix_operation"),o=n.getSelected();null!==o&&(this.$$("values").getItem(e).operation[i]=o.name,this.$$("values").updateItem(e)),n.close()},this))},remove:function(t,e){var i=webix.$$(t),o=this.innerId(i.config.id),n=this.$$(o).getItem(e);if("values"==o){var r=webix.html.locate(t,"webix_operation");n.operation.length>1?(n.operation.splice(r,1),this.$$("values").updateItem(e)):this._removeListField("values",n)}else this._removeListField(o,n);return!1}};function c(t,e){var i,o,n=[];for(i=0;i<t.length;i++)o=t[i],n.push({name:o,title:e(o)});return n}var p={header:function(t){return webix.i18n.pivot[t.value]},iconHeader:function(t){return t.icon?"<span class='webix_pivot_header_icon webix_icon icon-"+t.icon+"'></span>"+webix.i18n.pivot[t.value]:"<span class='webix_pivot_header_icon'>"+t.iconContent+"</span>"+webix.i18n.pivot[t.value]},tableValues:function(t){t.operation=t.operation||["sum"],webix.isArray(t.operation)||(t.operation=[t.operation]);for(var e=[],i=webix.$$(this.config.pivot)._applyLocale,o=0;o<t.operation.length;o++){var n="<div class='webix_pivot_link' webix_operation='"+o+"'>";n+="<span>"+t.text+"</span>",n+="<span class='webix_link_selection'>"+i(t.operation[o])+"</span>",n+="<span class='webix_pivot_minus webix_icon webix_pivot_close'>&#10005;</span>",n+="</div>",e.push(n)}return e.join(" ")},chartValues:function(t){t.operation=t.operation||["sum"],t.color=t.color||[],webix.isArray(t.operation)||(t.operation=[t.operation]);for(var e=[],i=webix.$$(this.config.pivot),o=i._applyLocale,n=0;n<t.operation.length;n++){t.color&&t.color[n]||(t.color[n]=i._getColor(this._valueLength),this._valueLength++);var r="<div class='webix_pivot_link' webix_operation='"+n+"'>";r+="<div class='webix_color_selection'><div style='background-color:"+o(t.color[n])+"'></div></div>",r+="<div class='webix_link_title'>"+t.text+"</div>",r+="<div class='webix_link_selection'>"+o(t.operation[n])+"</div>",r+="<span class='webix_pivot_minus webix_icon webix_pivot_close'>&#10005;</span>",r+="</div>",e.push(r)}return e.join(" ")},filters:function(t){var e=webix.$$(this.config.pivot);t.type=t.type||e.filters.getDefault();var i="<a class='webix_pivot_link'>"+t.text;return i+=" <span class='webix_link_selection'>"+e._applyLocale(t.type)+"</span>",i+="</a> ",i+="<span class='webix_pivot_minus webix_icon webix_pivot_close'>&#10005;</span>"},rows:function(t){var e="<a class='webix_pivot_link'>"+t.text;return e+="</a> ",e+="<span class='webix_pivot_minus webix_icon webix_pivot_close'>&#10005;</span>"},columns:function(t){var e="<a class='webix_pivot_link'>"+t.text;return e+="</a> ",e+="<span class='webix_pivot_minus webix_icon webix_pivot_close'>&#10005;</span>"},groupBy:function(t){var e="<a class='webix_pivot_link'>"+t.text;return e+="</a> ",e+="<span class='webix_pivot_minus webix_icon webix_pivot_close'>&#10005;</span>"},listDrag:function(t){return"<a class='webix_pivot_link'>"+t.text+"</a> "}};webix.protoUI({name:"webix_pivot_config_common",$init:function(t){webix.extend(t,this.defaults),webix.extend(t,this._getUI(t),!0),this.$ready.push(this._afterInit)},defaults:{padding:8,height:500,width:700,cancelButtonWidth:100,applyButtonWidth:85,head:!1,modal:!0,move:!0},_getUI:function(){return{}},_afterInit:function(){},setStructure:function(t){this.define("structure",t),this.render()},getStructure:function(){return{}},_lists:[],_dndCorrection:{},data_setter:function(t){var e,i=(t=webix.copy(t)).fields,o=this._lists;for(i.forEach(function(e){o.forEach(function(i){t[i].forEach(function(t){t.name==e.name&&(e.$css=" webix_pivot_field_selected")})})}),this.$$("fields").clearAll(),this.$$("fields").parse(i),e=0;e<o.length;e++)this.$$(o[e]).clearAll(),this.$$(o[e]).parse(t[o[e]])},_dropField:function(t){var e,i=t.from,o=t.to;if(o&&o!=i)return e=webix.copy(i.getItem(t.start)),o==this.$$("fields")?this._removeListField(this.innerId(i.config.id),e):this._addListField(this.innerId(o.config.id),e,t.index),!1},_addListField:function(t,e,i){this._handlers[t].call(this,t,e,i)},_removeListField:function(t,e){this.$$(t).remove(e.id);for(var i=this._lists,o=!1,n=0;!o&&n<i.length;n++)this.$$(i[n]).data.each(function(t){t.name==e.name&&(o=t)});o||this._setPivotFieldCss(e.name,"")},_setPivotFieldCss:function(t,e){this.$$("fields").data.each(function(i){i.name==t&&(i.$css=" "+e,this.refresh(i.id))})},_handlers:{filters:function(t,e){var i=!1,o=e.name,n=this.$$(t);n.data.each(function(t){t.name==o&&(i=!0)}),i||(delete e.id,n.add(e),this._setPivotFieldCss(o,"webix_pivot_field_selected"),this._correctLists(o,t))},rows:function(t,e){var i=!1,o=e.name,n=this.$$(t);n.data.each(function(t){t.name==o&&(i=!0)}),i||(delete e.id,n.add(e),this._setPivotFieldCss(o,"webix_pivot_field_selected"),this._correctLists(o,t))},columns:function(t,e){this._handlers.rows.call(this,t,e)},values:function(t,e,i){var o=null,n=this.$$(t);n.data.each(function(t){t.name==e.name&&(o=t)}),o?u.add.call(this,{},o.id):(this._setPivotFieldCss(e.name,"webix_pivot_field_selected"),n.add(webix.copy(e),i)),this._correctLists(e.name,t)},groupBy:function(t,e){if(this.$$(t).data.order.length){var i=this.$$(t).getFirstId();this._removeListField(t,this.$$("groupBy").getItem(i))}this._setPivotFieldCss(e.name,"webix_pivot_field_selected"),delete e.id,this.$$(t).add(e),this._correctLists(e.name,t)}},_correctLists:function(t,e){var i,o,n=this._dndCorrection[e];for(i=0;n&&i<n.length;i++)o=null,this.$$(n[i]).data.each(function(e){e.name==t&&(o=e)}),o&&this.$$(n[i]).remove(o.id)},_setStructure:function(t,e){return function(t,e,i,o){var n=["rows","cols"],r=["head","body"],a=t,s=o.on?o.on.onViewInit:null;return function t(o,l){var u,c,p;for(u=0;u<r.length;u++)p=null,l[r[u]]&&("string"==typeof l[r[u]]&&(p=l[r[u]],l[r[u]]=i[p]),t(p,l[r[u]]));for(u=0;u<n.length;u++)if(l[n[u]]){var h=l[n[u]];for(c=0;c<h.length;c++)p=null,"string"==typeof h[c]&&(p=h[c],l[n[u]][c]=i[p]),t(p,l[n[u]][c])}o&&o!=e&&!l.id&&(l.id=o),o&&s&&s.apply(a,[o,l])}(e,i[e]),i[e]}(this,"popup",t,e)},_listDragHTML:function(t){if(t.start){var e=this.getItem(t.start);t.html=this.type.templateStart(e,this.type)+p.listDrag(e)+this.type.templateEnd(e,this.type)}},_getListEvents:function(){return{onBeforeDrop:webix.bind(this._dropField,this),onBeforeDrag:this._listDragHTML,onBeforeDragIn:function(){webix.html.addCss(webix.DragControl.getNode(),"webix_pivot_drag_zone",!0)}}}},webix.ui.window,webix.IdSpace),webix.protoUI({name:"webix_pivot_config",defaults:{fieldsColumnWidth:230,popupWidth:890},$init:function(){this.$view.className+=" webix_popup webix_pivot"},_getUI:function(t){var e=webix.copy(function(t,e){return{popup:{width:e.popupWidth,head:"toolbar",body:"body"},toolbar:{view:"toolbar",borderless:!0,padding:10,cols:["configTitle",{margin:6,cols:["cancel","apply"]}]},configTitle:{id:"configTitle",view:"label",label:webix.i18n.pivot.windowTitle||""},cancel:{view:"button",id:"cancel",label:webix.i18n.pivot.cancel,width:e.cancelButtonWidth},apply:{view:"button",id:"apply",type:"form",label:webix.i18n.pivot.apply,width:e.applyButtonWidth},body:{type:"wide",rows:[{css:"webix_pivot_fields_layout",type:"space",cols:["fieldsLayout",{type:"wide",rows:[{type:"wide",css:"webix_pivot_configuration",rows:[{type:"wide",cols:["filtersLayout","columnsLayout"]},{type:"wide",cols:["rowsLayout","valuesLayout"]}]}]}]}]},fieldsLayout:{width:e.fieldsColumnWidth,rows:["fieldsHeader","fields"]},filtersLayout:{rows:["filtersHeader","filters"]},columnsLayout:{rows:["columnsHeader","columns"]},rowsLayout:{rows:["rowsHeader","rows"]},valuesLayout:{rows:["valuesHeader","values"]},fieldsHeader:{id:"fieldsHeader",data:{value:"fields"},css:"webix_pivot_header_fields",template:p.header,height:40},fields:{id:"fields",css:"webix_pivot_fields",view:"list",scroll:!0,type:{height:"auto"},drag:!0,template:"<span class='webix_pivot_list_marker'></span>#text#<span class='webix_pivot_list_drag'></span>",on:t._getListEvents()},filtersHeader:{id:"filtersHeader",data:{value:"filters",icon:"filter"},template:p.iconHeader,css:"webix_pivot_popup_title",height:40},filters:{id:"filters",view:"list",drag:!0,scroll:!1,template:webix.bind(p.filters,t),type:{height:"auto"},onClick:{webix_link_selection:webix.bind(u["filter-selector"],t),webix_pivot_minus:webix.bind(u.remove,t)},on:t._getListEvents()},columnsHeader:{id:"columnsHeader",data:{value:"columns",icon:"columns"},template:p.iconHeader,css:"webix_pivot_popup_title",height:40},columns:{id:"columns",view:"list",drag:!0,scroll:!1,type:{height:"auto"},template:webix.bind(p.columns,t),on:t._getListEvents(),onClick:{webix_pivot_minus:webix.bind(u.remove,t)}},rowsHeader:{id:"rowsHeader",data:{value:"rows",icon:"list"},template:p.iconHeader,css:"webix_pivot_popup_title",height:40},rows:{id:"rows",view:"list",drag:!0,scroll:!1,template:webix.bind(p.rows,t),type:{height:"auto"},on:t._getListEvents(),onClick:{webix_pivot_minus:webix.bind(u.remove,t)}},valuesHeader:{id:"valuesHeader",data:{value:"values",icon:"values"},template:p.iconHeader,css:"webix_pivot_popup_title",height:40},values:{id:"values",view:"list",scroll:!1,drag:!0,css:"webix_pivot_values",type:{height:"auto"},template:webix.bind(p.tableValues,t),onClick:{webix_link_selection:webix.bind(u.selector,t),webix_pivot_plus:webix.bind(u.add,t),webix_pivot_minus:webix.bind(u.remove,t)},on:t._getListEvents()}}}(this,t));return this._setStructure(e,t)},_lists:["filters","columns","rows","values"],_dndCorrection:{rows:["columns","values"],columns:["rows"],values:["rows"]},_afterInit:function(){this.attachEvent("onItemClick",function(t){var e=this.innerId(t);if("cancel"==e||"apply"==e){var i=this.getStructure();webix.$$(this.config.pivot).callEvent("onBefore"+e,[i])&&(this.callEvent("on"+e,[i]),this.hide())}});for(var t=this.$view.querySelectorAll(".webix_pivot_configuration .webix_list"),e=0;e<t.length;e++)t[e].setAttribute("window-message",webix.i18n.pivot.windowMessage)},getStructure:function(){var t={rows:[],columns:[],values:[],filters:[]};this.$$("rows").data.each(function(e){t.rows.push(e.name)}),this.$$("columns").data.each(function(e){t.columns.push(e.name)}),this.$$("values").data.each(function(e){t.values.push(e)}),this.$$("filters").data.each(function(e){t.filters.push(e)});var e=webix.$$(this.config.pivot);return e.config.structure.columnSort&&(t.columnSort=e.config.structure.columnSort),t}},webix.ui.webix_pivot_config_common);var h=i(2),f={fieldMap:{},yScaleWidth:300,columnWidth:150,filterLabelAlign:"right",filterPlaceholder:!1,filterWidth:200,filterMinWidth:150,filterLabelWidth:100,separateLabel:!0,headerTemplate:function(t){return this._applyMap(t.text||t.name)+"<span class='webix_pivot_operation'> "+this._applyLocale(t.operation)+"</span>"},format:function(t){return t&&"0"!=t?parseFloat(t).toFixed(3):t}};function d(t,e){var i="";i=t.config.readonly?t.config.readonlyTitle||"":"<div class='webix_pivot_config_msg'><div class='webix_pivot_icon_settings'></div>"+webix.i18n.pivot.pivotMessage+"</div>",e.header=i,e.width=t.config.yScaleWidth,e.exportAsTree=!0,t.config.footer&&(e.footer=t._applyLocale("total"))}var v={render:function(t){this.data.silent(function(){var t=this.url;this.clearAll(),this.url=t}),o(this.config.structure.filters),t?this._setData(t):this._loadResults()},$onLoad:function(t){if(t.fields&&(this._pivotFields=t.fields),t.options&&(this._pivotOptions=t.options),t.structure&&(this.config.structure=t.structure),t.operations){this.operations={};for(var e=0;e<t.operations.length;e++)this.operations[t.operations[e]]=1}t.data.columns&&(t.data.header=t.data.columns),t.data&&this.render(t.data)},url_setter:function(t){var e=this.config.structure;if(!e||!e.rows.length&&!e.columns.length)return webix.AtomDataLoader.url_setter.call(this,t);this.data.url=t,this._loadResults()},_loadResults:function(){var t=this.config.structure,e=this.data.url;e&&(e.load?e.load(this,{success:function(t){this.parse(JSON.parse(t))}},{structure:t}):"string"==typeof e&&this.load("post->"+e,"json",{structure:t}))}};var g=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._filters=["multicombo","select","text","datepicker"],this._selects={multicombo:1,multiselect:1,select:1,richselect:1}}return t.prototype.add=function(t,e){this._filters.push(t),webix.isUndefined(e)||(this._selects[t]=e)},t.prototype.isSelect=function(t){return this._selects[t]},t.prototype.clear=function(){this._filters=[]},t.prototype.remove=function(t){var e=this.getIndex(t);e>=0&&this._filters.splice(e,1)},t.prototype.getIndex=function(t){for(var e=0;e<this._filters.length;e++)if(this._filters[e]==t)return e;return-1},t.prototype.getDefault=function(){return-1!=this.getIndex("select")?"select":this._filters[0]},t.prototype.get=function(){return this._filters},t}(),_="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};webix.protoUI({name:"pivot",version:"{{version}}",defaults:f,$init:function(t){!1===t.separateLabel&&(t.filterWidth=t.filterWidth||300),this.$view.className+=" webix_pivot",this.data.provideApi(this,!0),this._setConfig(t),this._initDataStore(t),this.$separator=this.$divider,this.filters=new g},$divider:"_'_",_initDataStore:function(t){var e;t.externalProcessing?(e=this,webix.extend(e,v,!0),e.attachEvent("onFilterChange",function(){o(this.config.structure.filters),this._loadResults(!0)})):(this.data.attachEvent("onStoreUpdated",webix.bind(function(){this.$$("data")&&this.render()},this)),this.attachEvent("onFilterChange",function(){this.render(!0)}),this.$ready.push(this.render))},_setConfig:function(t){t.structure||(t.structure={}),webix.extend(t.structure,{rows:[],columns:[],values:[],filters:[]}),webix.extend(t,this._getUI(t))},_getUI:function(t){var e={view:"treetable",id:"data",select:"row",navigation:!0,leftSplit:1,resizeColumn:!0,rowHeight:42,rowLineHeight:42,headerRowHeight:50,on:{onHeaderClick:function(t){var e=this.getTopParentView();0!==this.getColumnIndex(t.column)||e.config.readonly||e.configure()}},columns:[]};return t.datatable&&"object"==_(t.datatable)&&(delete t.datatable.id,webix.extend(e,t.datatable,!0)),{rows:[{id:"filters",view:"toolbar",css:"webix_pivot_configure_toolbar",borderless:!0,hidden:!0,padding:10,cols:[{}]},e]}},configure:function(){this._configPopup||this._createPopup();var t=[];for(var e in this.operations)t.push({name:e,title:this._applyLocale(e)});this._configPopup.define("operations",t);var i=webix.html.offset(this.$$("data").getNode());this._configPopup.setPosition(i.x+10,i.y+10),this._configPopup.define("data",this.getFields()),this._configPopup.show()},_createPopup:function(){var t={view:"webix_pivot_config",operations:[],pivot:this.config.id};webix.extend(t,this.config.popup||{}),this._configPopup=webix.ui(t),this.callEvent("onPopup",[this._configPopup]),this._configPopup.attachEvent("onApply",webix.bind(this.setStructure,this))},destructor:function(){this._configPopup&&(this._configPopup.destructor(),this._configPopup=null),webix.Destruction.destructor.call(this)},getFilterView:function(){return this.$$("filters")},render:function(t){var e=this;webix.debug_pivot&&window.console.time("pivot:full-processing"),this._getPivotData||webix.extend(this,new h.b(this.config,this)),o(this.config.structure.filters),this._getPivotData(this.data.pull,this.data.order,function(i){e._setData(i,t),webix.debug_pivot&&webix.delay(function(){window.console.timeEnd("pivot:full-processing"),window.console.timeEnd("pivot:rendering")})})},_setData:function(t,e){!function(t,e){for(var i=t.config.format,o=0;o<e.length;o++)if(o){webix.extend(e[o],{format:i,sort:"int",width:t.config.columnWidth});for(var n=e[o].header,r=0;r<n.length;r++){var a=n[r];a&&(r||"total"!=a.name?r==n.length-1?a.text=t.config.headerTemplate.call(t,a):a.text=a.name:a.text=t._applyLocale("total"))}var s=e[o].footer,l=e[o].format;if(s){"string"==typeof s&&(s={text:s});var u=webix.isUndefined(s.$pivotValue)?s.text:s.$pivotValue;s.text=!l||"count"==s.$pivotOperation&&l==i?u:l(u)}}else d(t,e[o])}(this,t.header),e||(t.filters=r(this)),this.callEvent("onBeforeRender",[t]),t.filters&&s(this,t.filters),this.config.readonly&&(this.$$("data").$view.className+=" webix_pivot_readonly"),this.config.totalColumn&&this.$$("data").define("math",!0),this.config.footer&&this.$$("data").define("footer",!0),webix.debug_pivot&&window.console.time("pivot:rendering"),this.$$("data").clearAll(),this.$$("data").config.rightSplit=0,this.$$("data").refreshColumns(t.header),this.$$("data").parse(t.data),function(t){if(t.config.freezeTotal){var e,i=t.$$("data").config.columns,o=function(t){var e,i=0;for(e=0;e<t.length;e++)i+=t[e].width;return i}(i),n=function(t){for(var e=0,i=t.length-1;!e&&i>=0;i--)t[i].header[0]&&"total"==t[i].header[0].name&&(e=t.length-i);return e}(i);for(e=0;e<t.$$("data").config.leftSplit;e++)o-=i[e].width;for(e=i.length-1;e>i.length-n;e--)o-=i[e].width;o>100&&(t.$$("data").config.rightSplit=n,t.$$("data").refreshColumns())}}(this)},$exportView:function(t){if(t.flatTree){"object"!==_(t.flatTree)&&(t.flatTree={});var e=t.flatTree;if(e.id=this.$$("data").config.columns[0].id,!e.columns){var i=this.config.structure.rows;e.columns=[];for(var o=0;o<i.length;o++)e.columns.push({header:this._applyMap(i[o])})}}return webix.extend(t,{filterHTML:!0}),this.$$("data")},_applyLocale:function(t){return webix.i18n.pivot[t]||t},_applyMap:function(t){return this.config.fieldMap[t]||t},getFields:function(){var t,e,i,o=[],n={},r={},a=this.config.structure,s={fields:[],rows:[],columns:[],values:[],filters:[]},l={};if(this._pivotFields)for(o=this._pivotFields,t=0;t<o.length;t++)n[o[t]]=webix.uid();else for(t=0;t<Math.min(this.data.count()||5);t++)for(e in this.data.getItem(this.data.getIdByIndex(t)))"id"===e||0===e.indexOf("$")||n[e]||(o.push(e),n[e]=webix.uid());for(t=0;t<(a.filters||[]).length;t++)e=a.filters[t],webix.isUndefined(n[e.name])||(i=this._applyMap(e.name),s.filters.push({name:e.name,text:i,type:e.type,value:e.value,id:n[e.name]}));for(t=0;t<a.rows.length;t++)e=a.rows[t],webix.isUndefined(n[e])||(s.rows.push({name:e,text:this._applyMap(e),id:n[e]}),r[e]=!0);for(t=0;t<a.columns.length;t++)e="object"==_(a.columns[t])?a.columns[t].id||t:a.columns[t],!webix.isUndefined(n[e])&&webix.isUndefined(r[e])&&s.columns.push({name:e,text:this._applyMap(e),id:n[e]});for(t=0;t<a.values.length;t++)if(e=a.values[t],!webix.isUndefined(n[e.name]))if(webix.isUndefined(l[e.name])){l[e.name]=t,i=this._applyMap(e.name);var u={name:e.name,text:i,id:n[e.name],operation:webix.isArray(e.operation)?e.operation:[e.operation]};s.values.push(u)}else{var c=l[e.name];s.values[c].operation.push(e.operation)}for(o.sort(),t=0;t<o.length;t++)e=o[t],webix.isUndefined(n[e])||s.fields.push({name:e,text:this._applyMap(e),id:n[e]});return s},setStructure:function(t){this.define("structure",t),this.render()},getStructure:function(){return this.config.structure},getConfigWindow:function(){return this._configPopup},profile_setter:function(t){var e=window.console;t&&(this.attachEvent("onBeforeLoad",function(){e.time("data loading")}),this.data.attachEvent("onParse",function(){e.timeEnd("data loading"),e.time("data parsing")}),this.data.attachEvent("onStoreLoad",function(){e.timeEnd("data parsing"),e.time("data processing")}),this.$ready.push(function(){this.$$("data").attachEvent("onBeforeRender",function(){this.count()&&(e.timeEnd("data processing"),e.time("data rendering"))}),this.$$("data").attachEvent("onAfterRender",function(){this.count()&&webix.delay(function(){e.timeEnd("data rendering")})})}))}},webix.IdSpace,webix.ui.layout,webix.DataLoader,webix.EventSystem,webix.Settings);var b=webix.extend({color:function(t,e,i){var o={view:"colorboard",borderless:!0};webix.$$(this.config.pivot).config.colorboard?webix.extend(o,webix.$$(this.config.pivot).config.colorboard):webix.extend(o,{width:150,height:150,palette:webix.$$(this.config.pivot).config.palette});var n=webix.ui({view:"popup",id:"colorsPopup",body:o});return n.show(i),n.getBody().attachEvent("onSelect",function(){n.hide()}),n.attachEvent("onHide",webix.bind(function(){var i=webix.html.locate(t,"webix_operation"),o=n.getBody().getValue();o&&(this.$$("values").getItem(e).color[i]=o,this.$$("values").updateItem(e)),n.close()},this)),!1}},u);webix.protoUI({name:"webix_pivot_chart_config",$init:function(){this.$view.className+=" webix_pivot_chart_popup webix_pivot"},defaults:{chartTypeLabelWidth:100,chartTypeWidth:302,logScaleLabelWidth:125,fieldsColumnWidth:240,popupWidth:890},_getUI:function(t){var e=webix.copy(function(t,e){var i=[],o=webix.$$(e.pivot),n=o.chartMap;for(var r in n)i.push({id:r,title:o._applyLocale(r).toLowerCase()});var a=o.config.chartType;return{popup:{width:e.popupWidth,head:"toolbar",body:"body"},toolbar:{view:"toolbar",borderless:!0,padding:10,cols:["configTitle",{margin:6,cols:["cancel","apply"]}]},configTitle:{id:"configTitle",view:"label",label:webix.i18n.pivot.windowTitle||""},cancel:{view:"button",id:"cancel",label:o._applyLocale("cancel"),width:e.cancelButtonWidth},apply:{view:"button",id:"apply",type:"form",css:"webix_pivot_apply",label:o._applyLocale("apply"),width:e.applyButtonWidth},body:{type:"wide",rows:[{css:"webix_pivot_fields_layout",type:"space",cols:["fieldsLayout",{type:"wide",rows:[{type:"wide",css:"webix_pivot_configuration",rows:[{type:"wide",cols:["filtersLayout","groupLayout"]},{type:"wide",cols:["valuesLayout","chartLayout"]}]}]}]}]},fieldsLayout:{width:e.fieldsColumnWidth,rows:["fieldsHeader","fields"]},fieldsHeader:{id:"fieldsHeader",data:{value:"fields"},css:"webix_pivot_header_fields",template:p.header,height:40},fields:{view:"list",type:{height:"auto"},css:"webix_pivot_fields",drag:!0,template:"<span class='webix_pivot_list_marker'></span>#text#<span class='webix_pivot_list_drag'></span>",on:t._getListEvents()},filtersLayout:{rows:["filtersHeader","filters"]},filtersHeader:{data:{value:"filters",icon:"filter"},template:p.iconHeader,css:"webix_pivot_popup_title",height:40},filters:{view:"list",scroll:!1,type:{height:"auto"},drag:!0,template:webix.bind(p.filters,t),onClick:{webix_link_selection:webix.bind(b["filter-selector"],t),webix_pivot_minus:webix.bind(u.remove,t)},on:t._getListEvents()},valuesLayout:{rows:["valuesHeader","values"]},valuesHeader:{id:"valuesHeader",data:{value:"values",icon:"values-chart"},template:p.iconHeader,css:"webix_pivot_popup_title",height:40},values:{view:"list",scroll:!1,drag:!0,css:"webix_pivot_chart_values",type:{height:"auto"},template:webix.bind(p.chartValues,t),onClick:{webix_link_title:webix.bind(b.selector,t),webix_link_selection:webix.bind(b.selector,t),webix_color_selection:webix.bind(b.color,t),webix_pivot_minus:webix.bind(b.remove,t)},on:t._getListEvents()},groupLayout:{rows:["groupHeader","groupBy"]},groupHeader:{data:{value:"groupBy",icon:"group"},template:p.iconHeader,css:"webix_pivot_popup_title",height:40},groupBy:{view:"list",scroll:!1,drag:!0,type:{height:"auto"},template:webix.bind(p.groupBy,t),on:t._getListEvents(),onClick:{webix_pivot_minus:webix.bind(u.remove,t)}},chartLayout:{css:"webix_pivot_popup_chart",rows:["chartHeader","chartBody"]},chartHeader:{data:{value:"chart",icon:"chart"},template:p.iconHeader,css:"webix_pivot_popup_title",height:40},chartBody:{view:"list",scroll:!1,drag:!1,borderless:!0,type:{height:"auto",markCheckbox:function(t){return void 0===t.markCheckbox&&(o.config.chart.scale&&"logarithmic"==o.config.chart.scale?t.markCheckbox=1:t.markCheckbox=0),"<span class='webix_icon fa-"+(t.markCheckbox?"check-":"")+"square-o'></span>"},getType:function(t){return t.chartType=a}},onClick:{webix_link_selection:function(t,e,o){var n,r={view:"webix_pivot_popup",css:"webix_pivot_popup",autofit:!0,autoheight:!0,width:150,data:i};(n=webix.ui(r)).show(o),n.attachEvent("onHide",webix.bind(function(){var t=n.getSelected();null!==t&&(a=t.id,this.refresh()),n.close()},this))},webix_chart_checkbox:function(t,e){var i=this.getItem(e);i.markCheckbox=i.markCheckbox?0:1,this.updateItem(e,i)}},template:function(t,e){return"logScale"===t.id?"<div class='webix_chart_checkbox'>"+e.markCheckbox(t,e)+"<span>"+t.title.toLowerCase()+"</span></div>":"<span class='webix_chart_popup_icon'></span><span>"+webix.i18n.pivot.chartType.toLowerCase()+"</span><span class='webix_link_selection'>"+webix.i18n.pivot[e.getType(t,e)]+"</span>"},data:[{title:webix.i18n.pivot.logScale,id:"logScale"},{title:webix.i18n.pivot.chartType,id:"chartType",chartType:a}]}}}(this,t));return this._setStructure(e,t)},_lists:["filters","values","groupBy"],_dndCorrection:{values:["groupBy"],groupBy:["values"]},_hidePopups:function(){webix.callEvent("onClick",[])},_afterInit:function(){this.attachEvent("onItemClick",function(t){if("button"==this.$eventSource.name){var e=this.innerId(t),i=this.getStructure();"apply"!=e||i.values.length&&i.groupBy?webix.$$(this.config.pivot).callEvent("onBefore"+e,[i])&&(this.callEvent("on"+e,[i]),this.hide()):webix.alert(webix.i18n.pivot.valuesNotDefined)}});for(var t=this.$view.querySelectorAll(".webix_pivot_configuration .webix_list"),e=0;e<t.length;e++)t[e].setAttribute("window-message",webix.i18n.pivot.windowMessage)},getStructure:function(){var t,e={groupBy:"",values:[],filters:[]},i=this.$$("groupBy");return i.count()&&(e.groupBy=i.getItem(i.getFirstId()).name),this.$$("values").data.each(webix.bind(function(i){for(var o=0;o<i.operation.length;o++)t=webix.copy(i),webix.extend(t,{operation:i.operation[o],color:i.color[o]||webix.$$(this.config.pivot).config.color},!0),e.values.push(t)},this)),this.$$("filters").data.each(function(t){e.filters.push(t)}),e}},webix.ui.webix_pivot_config_common);var w=i(1),m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};webix.protoUI({name:"pivot-chart",version:"{{version}}",defaults:{fieldMap:{},rows:[],filterLabelAlign:"right",filterWidth:200,filterMinWidth:180,editButtonWidth:110,filterLabelWidth:100,filterPlaceholder:!1,separateLabel:!0,chartType:"bar",color:"#36abee",chart:{},singleLegendItem:1,palette:[["#e33fc7","#a244ea","#476cee","#36abee","#58dccd","#a7ee70"],["#d3ee36","#eed236","#ee9336","#ee4339","#595959","#b85981"],["#c670b8","#9984ce","#b9b9e2","#b0cdfa","#a0e4eb","#7faf1b"],["#b4d9a4","#f2f79a","#ffaa7d","#d6806f","#939393","#d9b0d1"],["#780e3b","#684da9","#242464","#205793","#5199a4","#065c27"],["#54b15a","#ecf125","#c65000","#990001","#363636","#800f3e"]]},templates:{groupNameToStr:function(t,e){return t+"_"+e},groupNameToObject:function(t){var e=t.split("_");return{name:e[0],operation:e[1]}},seriesTitle:function(t,e){var i=this.config.fieldMap[t.name]||this._capitalize(t.name),o=webix.isArray(t.operation)?t.operation[e]:t.operation;return i+" ( "+(webix.i18n.pivot[o]||o)+")"}},templates_setter:function(t){"object"==(void 0===t?"undefined":m(t))&&webix.extend(this.templates,t)},chartMap:{bar:function(t){return{border:0,alpha:1,radius:0,color:t}},line:function(t){return{alpha:1,item:{borderColor:t,color:t},line:{color:t,width:2}}},radar:function(t){return{alpha:1,fill:!1,disableItems:!0,item:{borderColor:t,color:t},line:{color:t,width:2}}}},chartMap_setter:function(t){"object"==(void 0===t?"undefined":m(t))&&webix.extend(this.chartMap,t,!0)},$init:function(t){!1===t.separateLabel&&(t.filterWidth=t.filterWidth||300),this.data.provideApi(this,!0),t.structure||(t.structure={}),webix.extend(t.structure,{groupBy:"",values:[],filters:[]}),this.$view.className+=" webix_pivot webix_pivot_chart",webix.extend(t,{editButtonWidth:this.defaults.editButtonWidth}),webix.extend(t,this.getUI(t)),this.$ready.push(webix.bind(function(){webix.delay(this.render,this)},this)),this.data.attachEvent("onStoreUpdated",webix.bind(function(){this.$$("chart")&&this.render()},this)),this.attachEvent("onFilterChange",function(){this.render(!0)}),this.filters=new g},getUI:function(){return{rows:[{view:"toolbar",id:"filters",hidden:!0,paddingY:10,paddingX:5,borderless:!0,margin:10,cols:[]},{id:"bodyLayout",type:"line",margin:10,cols:[{id:"chart",view:"chart"}]}]}},configure:function(){if(!this._pivotPopup){var t={view:"webix_pivot_chart_config",operations:[],pivot:this.config.id};webix.extend(t,this.config.popup||{}),this._pivotPopup=webix.ui(t),this.callEvent("onPopup",[this._pivotPopup]),this._pivotPopup.attachEvent("onApply",webix.bind(function(t){this.config.chartType=this._pivotPopup.$$("chartBody")?this._pivotPopup.$$("chartBody").getItem("chartType").chartType:"bar",this.config.chart.scale=this._pivotPopup.$$("chartBody").getItem("logScale").markCheckbox?"logarithmic":"linear",webix.extend(this.config.structure,t,!0),this.render()},this))}var e=[];for(var i in this.operations)e.push({name:i,title:this._applyLocale(i)});this._pivotPopup._valueLength=this._valueLength||0,this._pivotPopup.define("operations",e);var o=webix.html.offset(this.$$("chart").getNode());this._pivotPopup.setPosition(o.x+10,o.y+10),this._pivotPopup.define("data",this.getFields()),this._pivotPopup.show()},destructor:function(){this._pivotPopup&&(this._eventId&&webix.eventRemove(this._eventId),this._pivotPopup.destructor(),this._pivotPopup=null),webix.Destruction.destructor.call(this)},render:function(t){t||s(this,r(this));this._valueLength=0;var e=this.config.structure;e&&e.groupBy&&e.values&&e.values.length?(this._setChartConfig(),this._loadFilteredData()):(this.config.structure={values:[]},this._setChartConfig())},_setChartConfig:function(){for(var t=this.config,e=t.structure.values,i=0;i<e.length;i++)e[i].operation=e[i].operation||["sum"],webix.isArray(e[i].operation)||(e[i].operation=[e[i].operation]);var o=this.config.chartType||"bar",n=this.chartMap[o],r={type:n&&n("").type?n("").type:o,xAxis:webix.extend({template:"#id#"},t.chart.xAxis||{},!0),yAxis:webix.extend({},t.chart.yAxis||{})};webix.extend(r,t.chart),r.padding||(r.padding={top:17});var a=this._getSeries();for(var s in r.series=a.series,r.legend=!1,(t.singleLegendItem||this._valueLength>1)&&(r.legend=a.legend),r.scheme={$group:this._pivot_group,$sort:{by:"id"}},this.$$("chart").removeAllSeries(),r)this.$$("chart").define(s,r[s]);if(this.$$("chart")&&!this.config.readonly){var l=document.createElement("div");l.className="webix_pivot_configure",l.title=this._applyLocale("settings"),l.style.width=r.legend.width+"px",l.style.top=r.padding.top+"px",l.innerHTML="<span class='webix_pivot_icon_settings'></span><span class='webix_pivot_configure_label'>"+webix.i18n.pivot.pivotMessage+"</span>",this.$$("chart").$view.insertBefore(l,this.$$("chart").$view.querySelector("canvas")),this._eventId=webix.event(this.$$("chart").$view.querySelector(".webix_pivot_configure"),"click",function(){this.configure()}.bind(this))}},_applyLocale:function(t){return webix.i18n.pivot[t]||t},_capitalize:function(t){return t.charAt(0).toUpperCase()+t.slice(1)},_applyMap:function(t,e){return this.config.fieldMap[t]||(e?this._capitalize(t):t)},_loadFilteredData:function(){var t=this.config.structure.filters;o(t),Object(w.c)(t),this.data.silent(function(){var e=this;this.data.filter(function(i){return Object(w.a)(t,i,e.config.filterMap)})},this),this.$$("chart").data.silent(function(){this.$$("chart").clearAll()},this),this.$$("chart").parse(this.data.getRange()),this.data.silent(function(){this.data.filter("")},this)},groupNameToStr:function(t){return t.name+"_"+t.operation},groupNameToObject:function(t){var e=t.split("_");return{name:e[0],operation:e[1]}},_getSeries:function(){var t,e,i,o,n,r={},a=[],s=this.config.structure.values;for(i={valign:"middle",align:"right",width:220,layout:"y"},webix.extend(i,this.config.chart.legend||{},!0),i.values=[],i.marker||(i.marker={}),i.marker.type="line"==this.config.chartType?"item":"s",this.series_names=[],this._valueLength=0,t=0;t<s.length;t++)for(webix.isArray(s[t].operation)||(s[t].operation=[s[t].operation]),webix.isArray(s[t].color)||(s[t].color=[s[t].color||this._getColor(this._valueLength)]),e=0;e<s[t].operation.length;e++){o=this.templates.groupNameToStr(s[t].name,s[t].operation[e]),this.series_names.push(o),s[t].color[e]||(s[t].color[e]=this._getColor(this._valueLength));var l=s[t].color[e],u=this.chartMap[this.config.chartType](l)||{};u.value="#"+o+"#",u.tooltip={template:webix.bind(function(t){return t[this].toFixed(3)},o)},a.push(u),n=this.templates.seriesTitle.call(this,s[t],e),i.values.push({text:n,color:l}),r[o]=[s[t].name,s[t].operation[e]],this._valueLength++}return this._pivot_group={},s.length&&(this._pivot_group=webix.copy({by:this.config.structure.groupBy,map:r})),{series:a,legend:i}},_getColor:function(t){var e=this.config.palette,i=t/e[0].length;i=i>e.length?0:parseInt(i,10);var o=t%e[0].length;return e[i][o]},operations:{sum:1,count:1,max:1,min:1},addGroupMethod:function(t,e){this.operations[t]=1,e&&(webix.GroupMethods[t]=e)},removeGroupMethod:function(t){delete this.operations[t]},groupMethods_setter:function(t){for(var e in t)t.hasOwnProperty(e)&&this.addGroupMethod(e,t[e])},getFields:function(){var t,e=[],i={};for(t=0;t<Math.min(this.data.count()||5);t++){var o=this.data.getItem(this.data.getIdByIndex(t));for(var n in o)i[n]||(e.push(n),i[n]=webix.uid())}var r=this.config.structure,a={fields:[],groupBy:[],values:[],filters:[]},s="object"==m(r.groupBy)?r.groupBy[0]:r.groupBy;webix.isUndefined(i[s])||a.groupBy.push({name:s,text:this._applyMap(s),id:i[s]});var l,u={};for(t=0;t<r.values.length;t++)if(s=r.values[t],!webix.isUndefined(i[s.name]))if(l=this._applyMap(s.name),webix.isUndefined(u[s.name]))u[s.name]=a.values.length,a.values.push({name:s.name,text:l,operation:s.operation,color:s.color||[this._getColor(t)],id:i[s.name]});else{var c=a.values[u[s.name]];c.operation=c.operation.concat(s.operation),c.color=c.color.concat(s.color||[this._getColor(t)])}for(t=0;t<(r.filters||[]).length;t++)s=r.filters[t],webix.isUndefined(i[s.name])||(l=this._applyMap(s.name),a.filters.push({name:s.name,text:l,type:s.type,value:s.value,id:i[s]}));for(e.sort(),t=0;t<e.length;t++)s=e[t],webix.isUndefined(i[s])||a.fields.push({name:s,text:this._applyMap(s),id:i[s]});return a},setStructure:function(t){this.define("structure",t),this.render()},getStructure:function(){return this.config.structure},getConfigWindow:function(){return this._pivotPopup},getFilterView:function(){return this.$$("filters")},$exportView:function(t){return webix.extend(t,{ignore:{$group:!0,$row:!0}}),this.$$("chart")}},webix.IdSpace,webix.ui.layout,webix.DataLoader,webix.EventSystem,webix.Settings)},,function(t,e){webix.protoUI({name:"webix_pivot_popup",_selected:null,defaults:{autoheight:!0,padding:0},$init:function(t){webix.extend(t,this._get_ui(t)),this.$ready.push(this._after_init)},_get_ui:function(t){return{body:{id:"list",view:"list",borderless:!0,autoheight:!0,template:"#title#",data:t.data}}},_after_init:function(){this.attachEvent("onItemClick",function(t){this._selected=this.$eventSource.getItem(t),this.hide()})},getSelected:function(){return this._selected}},webix.ui.popup,webix.IdSpace)},function(t,e){webix.i18n.pivot=webix.extend(webix.i18n.pivot||{},{apply:"Apply",bar:"Bar",cancel:"Cancel",chart:"Chart",chartType:"Chart type",columns:"Columns",count:"count",date:"date",datepicker:"datepicker",fields:"Fields",filters:"Filters",groupBy:"Group By",line:"Line",logScale:"Logarithmic scale",max:"max",min:"min",multicombo:"multi-select",operationNotDefined:"Operation is not defined",layoutIncorrect:"pivotLayout should be an Array instance",pivotMessage:"Click to configure",popupHeader:"Pivot Settings",radar:"Radar",radarArea:"Area Radar",rows:"Rows",select:"select",settings:"Settings",stackedBar:"Stacked Bar",sum:"sum",text:"text",total:"Total",values:"Values",valuesNotDefined:"Values or Group field are not defined",windowTitle:"Pivot Configuration",windowMessage:"move fields here"})},,function(t,e,i){}]);