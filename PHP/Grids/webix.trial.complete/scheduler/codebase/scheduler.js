!function(e){var t={};function a(i){if(t[i])return t[i].exports;var n=t[i]={i:i,l:!1,exports:{}};return e[i].call(n.exports,n,n.exports,a),n.l=!0,n.exports}a.m=e,a.c=t,a.d=function(e,t,i){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(a.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)a.d(i,n,function(t){return e[t]}.bind(null,n));return i},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="/codebase/",a(a.s=0)}([function(e,t,a){"use strict";a.r(t);a(16);var i={init_date:new Date,form_date:"%d-%m-%Y %H:%i",form_all_day:"%d-%m-%Y",parse_date:"%Y-%m-%d %H:%i",week_date:"%D, %d %M",dyn_load_date:"%Y-%m-%d",item_date:"%d.%m.%Y",all_day_date:"%l, %d %F %Y",day_header_date:"%d.%m.%Y",week_header_date:"%d.%m.%Y",hour_date:"%H:%i",scale_hour:"%H",calendar_date:"%F %Y",calendar_hour:"%H:%i",form_rules:{end_date:function(e,t){return t.start_date.valueOf()<e.valueOf()}},multi_day:!0,multi_day_limit:3,views:[],tab_views:[],server_utc:!1,separate_short_events:!0,recurring:!1,endless_date:new Date(9999,1,1),recurring_dialogs:!1};var n,r,l,s,o={day_event_style:function(e){var t="";if(e.color){var a=webix.color.toRgb(e.color);t+=";border-color:"+e.color+";",t+="background-color:rgba("+a.toString()+",0.3);";var i=webix.color.rgbToHsv(a[0],a[1],a[2]);i[2]/=1.6,t+="color:"+("rgb("+webix.color.hsvToRgb(i[0],i[1],i[2])+")")}return t},multi_day_event_style:function(e){var t="";if(e.color){var a=webix.color.toRgb(e.color);t+=";background-color:rgba("+a.toString()+",0.3);";var i=webix.color.rgbToHsv(a[0],a[1],a[2]);i[2]/=1.6,t+="color:"+("rgb("+webix.color.hsvToRgb(i[0],i[1],i[2])+")")}return t},selected_event:function(e){var t="",a="",i="",n=e.start_date,r=e.end_date;if(!n)return t;if(t+="<div  class='selected_event "+scheduler.templates.event_class(e)+"'  >",t+="<div class='event_title'>"+e.text+"</div>",webix.Date.datePart(n,!0).valueOf()==webix.Date.datePart(r,!0).valueOf()){var l=webix.i18n.dateFormatStr(n);a=webix.i18n.timeFormatStr(n),i=webix.i18n.timeFormatStr(r),t+="<div class='event_text'>"+l+"</div>",t+="<div class='event_text'>"+scheduler.locale.labels.label_from+" "+a+" "+scheduler.locale.labels.label_to+" "+i+"</div>"}else{var s=webix.i18n.longDateFormatStr(n),o=webix.i18n.longDateFormatStr(r);webix.Date.datePart(n,!0).valueOf()==n.valueOf()&&webix.Date.datePart(r,!0).valueOf()==r.valueOf()||(a=webix.i18n.timeFormatStr(n)+" ",i=webix.i18n.timeFormatStr(r)+" "),t+="<div class='event_text'>"+scheduler.locale.labels.label_from+" "+a+s+"</div>",t+="<div class='event_text'>"+scheduler.locale.labels.label_to+" "+i+o+"</div>"}return e.details&&""!==e.details&&(t+="<div class='event_title'>"+scheduler.locale.labels.label_details+"</div>",t+="<div class='event_text'>"+e.details+"</div>"),t+="</div>"},week_title:function(e){var t=webix.Date.weekStart(e),a=webix.Date.add(t,6,"day",!0);return"<div aria-live='assertive' aria-atomic='true'>"+webix.i18n.headerWeekFormatStr(t)+"&nbsp;-&nbsp;"+webix.i18n.headerWeekFormatStr(a)+"</div>"},day_title:function(e){return"<div aria-live='assertive' aria-atomic='true'>"+webix.i18n.headerFormatStr(e)+"</div>"},calendar_event:function(e){return"<div class='webix_cal_day_event'>"+e.getDate()+"</div><div class='webix_cal_event_marker'></div>"},calendar_day:function(e){return e.getDate()},event_date:function(e){var t=new Date(parseInt(e,10));return"<span class='webix_unit_header_inner"+(webix.Date.datePart(t).valueOf()==webix.Date.datePart(new Date).valueOf()?" today":"")+"'>"+webix.i18n.weekDateFormatStr(t)+"</span>"},event_time:function(e){var t=e.start_date,a=e.end_date;return webix.Date.datePart(t,!0).valueOf()!=t.valueOf()||webix.Date.datePart(a,!0).valueOf()!=a.valueOf()?webix.i18n.timeFormatStr(t):scheduler.locale.labels.label_allday},event_marker:function(e){var t="";if(e.color){var a=webix.color.toRgb(e.color);t+=";border-color:"+e.color+";",t+="background-color:rgba("+a.toString()+",0.9);"}return"<div class='webix_event_marker' ><div style='"+t+"'></div></div>"},event_title:function(e,t){return"<div class='webix_event_overall "+t.eventClass(e,t)+"'><div class='webix_event_time'>"+t.timeStart(e)+"</div>"+t.marker(e,t)+"<div class='webix_event_text' "+(e.textColor?"style='color:"+e.textColor:"")+"'>"+e.text+"</div></div>"},month_event_title:function(e,t){return"<div class='webix_event_overall "+t.eventClass(e,t)+"'><div class='webix_event_time'>"+t.timeStart(e)+"</div>"+t.marker(e,t)+"<div class='webix_event_text' "+(e.textColor?"style='color:"+e.textColor:"")+"'>"+e.text+"</div></div>"},day_event:function(e){return e.text},multi_day_event:function(e){return e.text},new_event_data:function(){var e=webix.Date.add(new Date,1,"hour",!0).getHours(),t=webix.Date.copy(this.coreData.getValue());return t.setHours(e),{start_date:t,end_date:webix.Date.add(t,1,"hour",!0)}},event_class:webix.template("")};a(14),a(13),a(12),a(11),a(10),a(9),a(8),a(7),a(6),a(5),a(4),a(3),a(2),a(1);window.scheduler||(window.scheduler={config:{},templates:{},xy:{},locale:{}}),scheduler.locale||(scheduler.locale={}),scheduler.locale.labels={week_tab:"Week",day_tab:"Day",month_tab:"Month",icon_today:"Today",icon_add:"Add",icon_save:"Save",icon_done:"Done",icon_delete:"Delete event",icon_cancel:"Cancel",icon_edit:"Edit",icon_back:"Back",icon_close:"Close form",icon_yes:"Yes",icon_no:"No",icon_prev_day:"Previous day",icon_next_day:"Next week",icon_prev_week:"Previous week",icon_next_week:"Next day",confirm_closing:"Your changes will be lost, are your sure ?",confirm_deleting:"The event will be deleted permanently, are you sure?",label_event:"Event",label_start:"Start",label_end:"End",label_details:"Notes",label_from:"from",label_to:"to",label_allday:"All day",label_time:"Time",label_no_events:"No Events",recurring:{none:"Never",daily:"Daily",day:"day(s)",every:"Every",weekly:"Weekly",week:"week(s) on",each:"Each",on_day:"on the",monthly:"Monthly",month:"month(s)",month_day:"on what day of the month",week_day:"on what day of the week",yearly:"Yearly",year:"year(s) in",counters:["the first","the second","the third","the fourth","the fifth"],never:"Never",repeat:"Repeat",end_repeat:"End repeat",endless_repeat:"Endless repeat",end_repeat_label:"Repeat will end by",edit_message:"Do you want to edit the whole set of repeated events?",edit_series:"Edit series",edit_occurrence:"Edit occurrence",delete_message:"Do you want to delete the whole set of repeated events?",delete_series:"Delete series",delete_occurrence:"Delete occurrence"}},scheduler.config=i,scheduler.xy={confirm_height:231,confirm_width:250,scale_width:40,min_event_height:20,scale_height:20,week_tab:60,day_tab:60,month_tab:68,icon_today:55,icon_save:90,icon_done:90,icon_cancel:80,icon_edit:90,icon_back:70,list_header_height:30,list_height:50,all_day:120,month_list_height:50,recurring:{label_end_repeat:140,label_end_by:240,label_every:65,work_days:180}},scheduler.templates=o,webix.ready(function(){webix.callEvent("onBeforeSchedulerInit",[]),scheduler.locale&&scheduler.locale.date&&(webix.Date.Locale=scheduler.locale.date);var e=scheduler.config,t=scheduler.locale.labels,a=scheduler.templates;!function(){var e=scheduler.config,t=scheduler.locale.labels;if(e.form||(e.form=[{view:"text",label:t.label_event,labelWidth:90,name:"text"},{view:"datetext",label:t.label_start,labelWidth:90,id:"start_date",name:"start_date",dateFormat:e.form_date},{view:"datetext",label:t.label_end,labelWidth:90,id:"end_date",name:"end_date",dateFormat:e.form_date},{view:"checkbox",id:"allDay",name:"allDay",label:t.label_allday,labelWidth:100,value:0},{view:"textarea",label:t.label_details,name:"details",labelWidth:90,height:150},{}]),!e.calendar_hour){var a=e.hour_date.match(/%[h,H,g,G]/gi),i=e.hour_date.match(/%[a,A]/gi);e.calendar_hour=a[0]+(i?" "+i[0]:"")}e.bottom_toolbar||(e.bottom_toolbar=[{view:"button",id:"today",name:"today",type:"flat",label:t.icon_today,inputWidth:scheduler.xy.icon_today,align:"center",width:scheduler.xy.icon_today+6},{view:"segmented",id:"buttons",value:e.mode||"week",align:"center",multiview:!0,options:[{id:"day",value:t.day_tab,width:scheduler.xy.day_tab},{id:"week",value:t.week_tab,width:scheduler.xy.week_tab},{id:"month",value:t.month_tab,width:scheduler.xy.month_tab}]},{view:"ariabutton",label:t.icon_add,type:"icon",icon:"plus",name:"add",id:"add",align:"center",width:45,batch:"default"},{view:"label",label:"",width:45,batch:"readonly"}]),e.day_toolbar||(e.day_toolbar=[{view:"ariabutton",label:t.icon_prev_day,type:"iconprev",id:"prev",align:"left",width:40},{view:"label",id:"date",align:"center"},{view:"ariabutton",label:t.icon_next_day,type:"iconnext",id:"next",align:"right",width:40}]),e.week_toolbar||(e.week_toolbar=[{view:"ariabutton",label:t.icon_prev_week,type:"iconprev",name:"prevWeek",id:"prevWeek",width:40,align:"left"},{view:"label",id:"weekTitle",align:"center"},{view:"ariabutton",label:t.icon_next_week,type:"iconnext",id:"nextWeek",align:"right",width:40}]),e.selected_toolbar||(e.selected_toolbar=[{view:"button",width:scheduler.xy.icon_back,type:"flat",name:"back",id:"back",align:"center",label:t.icon_back},{view:"button",inputWidth:scheduler.xy.icon_edit,name:"edit",id:"edit",align:"right",label:t.icon_edit}]),e.form_toolbar||(e.form_toolbar=[{view:"button",type:"flat",width:scheduler.xy.icon_cancel,name:"cancel",id:"cancel",align:"center",label:t.icon_cancel},{view:"button",inputWidth:scheduler.xy.icon_save,name:"save",id:"save",align:"right",label:t.icon_save}]),e.date_toolbar||(e.date_toolbar=[{view:"button",type:"flat",width:scheduler.xy.icon_cancel,name:"cancel_date",id:"cancel_date",align:"center",label:t.icon_cancel},{view:"label",id:"datetype",align:"center"},{view:"button",width:scheduler.xy.icon_done,name:"done",id:"done",align:"right",label:t.icon_done}])}();var i={cssNoEvents:"no_events",timeStart:a.event_time,marker:a.event_marker,eventClass:a.event_class};scheduler.types={event_list:webix.extend({name:"EventsList",css:"events",headerHeight:scheduler.xy.list_header_height,height:scheduler.xy.list_height,templateHeader:a.event_date,template:a.event_title},i),day_event_list:webix.extend({name:"DayEventsList",css:"day_events",height:scheduler.xy.month_list_height,template:a.month_event_title},i),multi_day_list:{name:"MultiDayEvents",height:32,css:"multi_day_events",classname:function(e,t,a){var i="webix_list_item";return a&&a.$css&&(i+=" "+a.$css),i},aria:function(e,t,a){return"role='option'"+(a&&a.webix_selected?" aria-selected='true' tabindex='0'":" tabindex='-1'")},templateCss:scheduler.templates.event_class,templateStart:webix.template("<div webix_l_id='#id#' {common.aria()} class='{common.classname()} {common.templateCss()}' style='width:{common.widthSize()}; height:{common.heightSize()}; overflow:hidden;{common.templateColor()};'>"),template:a.multi_day_event,templateColor:function(e){return scheduler.templates.multi_day_event_style(e)}}},webix.type(webix.ui.weekevents,scheduler.types.event_list),webix.type(webix.ui.list,scheduler.types.day_event_list),webix.type(webix.ui.list,scheduler.types.multi_day_list),webix.DataDriver.scheduler={records:"/*/event"},webix.extend(webix.DataDriver.scheduler,webix.DataDriver.xml);var n=[{id:"day",rows:[{id:"dayBar",view:"toolbar",css:"webix_topbar",cols:e.day_toolbar},{id:"multiDayList",view:"list",autoheight:!0,type:"MultiDayEvents",yCount:e.multi_day_limit},{id:"dayList",view:"dayevents"}]},{id:"week",rows:[{id:"weekBar",view:"toolbar",css:"webix_topbar",elements:e.week_toolbar},{id:"weekEventsList",view:"weekevents",type:"EventsList",startDate:new Date,noEvents:t.label_no_events}]},{id:"month",view:"scrollview",scroll:!1,body:{rows:[{id:"calendar",view:"calendar",width:0,icons:!1,minHeight:310,dayWithEvents:a.calendar_event,dayNoEvents:a.calendar_day,calendarHeader:e.calendar_date},{id:"calendarDayEvents",view:"list",type:"DayEventsList"}]}}].concat(e.tab_views),r={view:"button",height:44,label:t.icon_delete,id:"delete",type:"danger",css:"delete"};screen.width>500&&(r.width=300,r={type:"clean",cols:[{},r,{}]});var l=[{rows:[{view:"multiview",id:"tabViews",animate:!!webix.env.touch&&{},cells:n},{id:"bottomBar",css:"webix_bottombar",height:55,padding:5,visibleBatch:"default",cols:e.bottom_toolbar}]},{id:"event",rows:[{id:"eventBar",view:"toolbar",css:"webix_subbar",elements:e.selected_toolbar},{type:"clean",paddingX:10,rows:[{id:"eventTemplate",view:"template",css:"webix_event_view",template:a.selected_event},r,{view:"template",height:20}]}]},{id:"form",rows:[{id:"editBar",view:"toolbar",css:"webix_subbar",elements:e.form_toolbar},{id:"editForm",view:"form",scroll:!0,elements:e.form,rules:e.form_rules}]},{id:"formdate",rows:[{id:"dateBar",view:"toolbar",css:"webix_subbar",elements:e.date_toolbar},{id:"dateForm",type:"clean",rows:[{view:"calendar",height:310,timepickerHeight:35,css:"form_calendar",icons:!1,id:"formCalendar",width:0,calendarTime:e.calendar_hour,timepicker:1,hourStart:0},{view:"template",css:"form_template"}]}]}].concat(e.views);webix.protoUI({name:"scheduler",version:"{{version}}",defaults:{rows:[{view:"multiview",id:"views",animate:!!webix.env.touch&&{},cells:l}],color:"#color#",textColor:"#textColor#"},_setDateMethods:function(){webix.i18n.dateFormat=e.item_date,webix.i18n.weekDateFormat=e.week_date,webix.i18n.formDate=e.form_date,webix.i18n.formAllDayFormat=e.form_all_day,webix.i18n.timeFormat=e.hour_date,webix.i18n.fullDateFormat=e.parse_date,webix.i18n.fullDateFormatUTC=e.server_utc,webix.i18n.longDateFormat=e.all_day_date,webix.i18n.headerFormatStr=webix.Date.dateToStr(e.day_header_date),webix.i18n.headerWeekFormatStr=webix.Date.dateToStr(e.week_header_date),webix.i18n.loadDateFormat=e.dyn_load_date;for(var t=["formDate","formAllDayFormat","loadDateFormat","weekDateFormat"],a=0;a<t.length;a++){var i=t[a],n=webix.i18n[i+"UTC"];webix.i18n[i+"Str"]=webix.Date.dateToStr(webix.i18n[i],n),webix.i18n[i+"Date"]=webix.Date.strToDate(webix.i18n[i],n)}webix.i18n.setLocale()},$init:function(){this.name="scheduler",this.$view.className+=" webix_scheduler",this._setDateMethods(e),this.data.provideApi(this),this.data.scheme({$init:function(e){"string"==typeof e.start_date&&(e.start_date=webix.i18n.fullDateFormatDate(e.start_date)),"string"==typeof e.end_date&&(e.end_date=webix.i18n.fullDateFormatDate(e.end_date))},$update:function(e){"string"==typeof e.start_date&&(e.start_date=webix.i18n.fullDateFormatDate(e.start_date)),"string"==typeof e.end_date&&(e.end_date=webix.i18n.fullDateFormatDate(e.end_date))},$serialize:function(e){var t={};return t.start_date=webix.i18n.fullDateFormatStr(webix.Date.copy(e.start_date)),t.end_date=webix.i18n.fullDateFormatStr(webix.Date.copy(e.end_date)),webix.extend(t,e),t}}),this.$ready.push(this._initStructure),webix.callEvent("onAfterSchedulerInit",[this])},syncData:function(e,t,a,i){var n=this.getEvents(t,a),r=e.data.pull={},l=e.data.order=webix.toArray();n=this._correctEventsDates(t,n);for(var s=0;s<n.length;s++)if(!i||i.call(e,n[s],t,a)){var o=n[s].id;l.push(o),r[o]=n[s]}},_syncAllViews:function(){this.coreData.callEvent("onChange",[]),this.$$("multiDayList").getParentView().resize()},getWeekTitle:function(e){return scheduler.templates.week_title(e)},getDayTitle:function(e){return scheduler.templates.day_title(e)},getTodayMultiEvents:function(){var e=this.getTopParentView(),t=webix.Date.datePart(e.coreData.getValue(),!0),a=webix.Date.add(t,1,"day",!0);e.syncData(this,t,a,function(e){var i=webix.Date.datePart(e.start_date,!0),n=webix.Date.datePart(e.end_date,!0);return!webix.Date.equal(i,n)&&e.start_date.valueOf()<=t.valueOf()&&e.end_date.valueOf()>=a.valueOf()}),this.resize()},getWeekEvents:function(){var t=this.getTopParentView(),a=webix.Date.weekStart(t.coreData.getValue()),i=webix.Date.add(a,6,"day",!0),n=null;e.multi_day&&t.$$("weekEventsList").isVisible()&&(n=function(e){var t=webix.Date.datePart(e.start_date,!0),n=webix.Date.datePart(e.end_date,!0);return webix.Date.equal(t,n)||e.start_date.valueOf()>a.valueOf()||e.end_date.valueOf()<i.valueOf()||e.start_date.valueOf()<=a.valueOf()&&e.end_date.valueOf()>=i.valueOf()}),t.syncData(this,a,i,n)},getTodayEvents:function(){var t=this.getTopParentView(),a=webix.Date.datePart(t.coreData.getValue(),!0),i=webix.Date.add(a,1,"day",!0),n=null;e.multi_day&&t.$$("dayList").isVisible()&&(n=function(e){var t=webix.Date.datePart(e.start_date,!0),n=webix.Date.datePart(e.end_date,!0);return webix.Date.equal(t,n)||e.start_date.valueOf()>a.valueOf()||e.end_date.valueOf()<i.valueOf()}),t.syncData(this,a,i,n)},_setMonthFlags:function(){if(this.isVisible()){var e=this.getTopParentView(),t=webix.Date.datePart(webix.Date.copy(this.getVisibleDate()));t.setDate(1);var a=webix.Date.add(t,1,"month",!0);e._eventsByDate={};for(var i=e.getEvents(t,a);t<a;){for(var n=webix.Date.add(t,1,"day",!0),r=0;r<i.length;r++)i[r].start_date<n&&i[r].end_date>t&&(e._eventsByDate[t.valueOf()]=!0);t=n}}},_initHotKeys:function(){function e(e){var t=e.getSelectedId()||e.locate(document.activeElement);t&&this._on_event_clicked(t)}webix.UIManager.addHotKey("enter",webix.bind(e,this),this.$$("dayList")),webix.UIManager.addHotKey("enter",webix.bind(e,this),this.$$("weekEventsList")),webix.UIManager.addHotKey("enter",webix.bind(e,this),this.$$("multiDayList")),webix.UIManager.addHotKey("enter",webix.bind(e,this),this.$$("calendarDayEvents"))},_initStructure:function(){if(this._initToolbars(),this._initMonth(),this._initHotKeys(),this.coreData=new webix.DataValue,this.coreData.setValue(e.init_date),this.$$("dayList").define("date",this.coreData),this.selectedEvent=new webix.DataRecord,this.config.readonly?this.define("readonly",this.config.readonly):e.readonly&&this.define("readonly",!0),this.$$("date")){var t=this.getDayTitle(e.init_date);this.$$("date").setValue(t),this.$$("date").config.label=this.$$("date").config.value,this.$$("date").bind(this.coreData,null,webix.i18n.headerFormatStr)}if(this.$$("weekTitle")){var a=this.getWeekTitle(e.init_date);this.$$("weekTitle").setValue(a),this.$$("weekTitle").config.label=a,this.$$("weekTitle").bind(this.coreData,null,webix.bind(this.getWeekTitle,this))}this.data.attachEvent("onStoreUpdated",this._sortDates),this.data.attachEvent("onStoreUpdated",webix.bind(this._syncAllViews,this)),e.multi_day&&(this.$$("multiDayList").define("dataFeed",this.getTodayMultiEvents),this.$$("multiDayList").bind(this.coreData)),this.$$("weekEventsList").define("dataFeed",this.getWeekEvents),this.$$("weekEventsList").bind(this.coreData),this.$$("dayList").define("dataFeed",this.getTodayEvents),this.$$("dayList").bind(this.coreData),this.$$("calendarDayEvents").define("dataFeed",this.getTodayEvents),this.$$("calendarDayEvents").bind(this.coreData),this.$$("calendar").bind(this.coreData),this.$$("calendar").attachEvent("onBeforeRender",this._setMonthFlags),this.coreData.attachEvent("onChange",webix.bind(function(){this._isFormCalendarZoomed||(this._load_mode&&this._load_url&&this.load.apply(this,[this._load_url]),this.$$("calendar").render())},this)),this.data.attachEvent("onClearAll",webix.bind(function(){this._loaded_ranges={}},this)),this.data.attachEvent("onIdChange",webix.bind(function(){this._syncAllViews()},this)),this.$$("eventTemplate").bind(this),this.$$("weekEventsList").attachEvent("onItemClick",webix.bind(this._on_event_clicked,this)),this.$$("dayList").attachEvent("onItemClick",webix.bind(this._on_event_clicked,this)),this.$$("multiDayList").attachEvent("onItemClick",webix.bind(this._on_event_clicked,this)),this.$$("calendarDayEvents").attachEvent("onItemClick",webix.bind(this._on_event_clicked,this)),this.$$("tabViews").attachEvent("onViewChange",webix.bind(this._onViewChanged,this)),this.attachEvent("onBeforeEventShow",webix.bind(this._onViewChanged,this)),this.$$(e.mode||"week").show(!1,!1),this._initForm()},_initForm:function(){this.$$("editForm").bind(this),this.dateField=new webix.DataValue,this.dateField.setValue("start_date"),this.$$("datetype").bind(this.dateField,null,function(e){return"start_date"==e?t.label_start:t.label_end}),this.$$("formCalendar").attachEvent("onAfterZoom",webix.bind(function(e){this._isFormCalendarZoomed=!!e,e&&this.$$("cancel_date").hide()},this)),this.$$("formCalendar").attachEvent("onBeforeRender",webix.bind(function(){this.$$("cancel_date").show()},this))},_onViewChanged:function(){this.$$("multiDayList").unselectAll(),this.$$("dayList").unselectAll(),this.$$("weekEventsList").unselectAll(),this.$$("calendarDayEvents").unselectAll()},_on_event_clicked:function(e){this._last_selected=(e||"").toString().split("#"),this._last_selected[1]&&this.setCursor(null),this.setCursor(this._last_selected[0]),this.callEvent("onBeforeEventShow",[this._last_selected[0]])&&this.$$("event").show()},_sortDates:function(){this.blockEvent(),this.sort(function(e,t){return e.start_date<t.start_date?-1:1}),this.unblockEvent()},_initMonth:function(){this.$$("calendar").attachEvent("onDateSelect",webix.bind(function(e){this._isMonthCalendarZoomed=!1,this.setDate(e)},this)),this.$$("calendar").attachEvent("onChange",webix.bind(function(e){this._isMonthCalendarZoomed||(this.$$("calendar").blockEvent(),this.setDate(e),this.$$("calendar").unblockEvent())},this)),this.$$("calendar").attachEvent("onAfterZoom",webix.bind(function(e){this._isMonthCalendarZoomed=!!e,e||this.$$("calendar").callEvent("onBeforeMonthChange",[null,this.$$("calendar").config.date])},this)),this.$$("calendar").attachEvent("onBeforeMonthChange",webix.bind(function(e,t){if(!this._isFormCalendarZoomed){var a=new Date;t.getMonth()===a.getMonth()&&t.getYear()===a.getYear()?t=a:t.setDate(1),this._isMonthCalendarZoomed||(this.$$("tabViews").config.animate?webix.ui.animateView(this.$$("month").getBody(),webix.bind(function(){this.setDate(t)},this),{type:"slide",direction:e<t?"left":"right"}):this.setDate(t))}},this)),this.$$("calendar").config.dayTemplate=webix.bind(function(e){return this._eventsByDate&&this._eventsByDate[e.valueOf()]?this.$$("calendar").config.dayWithEvents(e):this.$$("calendar").config.dayNoEvents(e)},this)},getEvents:function(e,t){t||(t=new Date(9999,0,1));for(var a=[],i=this.data.getRange(),n=0;n<i.length;n++)i[n].start_date<t&&i[n].end_date>e&&a.push(webix.copy(i[n]));return a},_correctEventsDates:function(e,t){var a,i=[];if(t)for(var n=0;n<t.length;n++){a={start_date:webix.Date.copy(t[n].start_date),end_date:webix.Date.copy(t[n].end_date)},webix.extend(a,t[n]),a.start_date.valueOf()<e.valueOf()&&(a.start_date=webix.Date.add(webix.Date.datePart(a.start_date),1,"day",!0));var r=(r||"").toString().split("#"),l=a.rec_type?new Date(1e3*r[1]+1e3*a.event_length):a.end_date;l.valueOf()>webix.Date.add(e,1,"day",!0).valueOf()&&(l=webix.Date.datePart(l),a.end_date=webix.Date.add(l,1,"day",!0)),i.push(a)}return i},setDate:function(e,t,a){e=e?webix.Date.datePart(e,!0):this.coreData.getValue(),t&&(e=webix.Date.add(e,t,a,!0)),this.coreData.setValue(e)},_initToolbars:function(){this.attachEvent("onItemClick",function(e){var a=this.innerId(e);switch(a){case"today":this.setDate(new Date);break;case"add":if("form"==this.innerId(this.$$("views").getActiveId())){var i=this;webix.confirm({height:scheduler.xy.confirm_height,width:scheduler.xy.confirm_width,title:t.icon_close,message:t.confirm_closing,callback:function(e){e&&i._addEvent()},ok:t.icon_yes,cancel:t.icon_no,css:"confirm"})}else this._addEvent();break;case"prev":this.setDate(null,-1,"day");break;case"next":this.setDate(null,1,"day");break;case"prevWeek":this.setDate(null,-1,"week");break;case"nextWeek":this.setDate(null,1,"week");break;case"edit":this._editEvent();break;case"cancel_date":case"back":this.$$("views").back();break;case"cancel":this.callEvent("onAfterCursorChange",[this.getCursor()]),this.$$("views").back();break;case"save":this._saveEvent();break;case"delete":this._deleteEvent();break;case"start_date":case"end_date":"datetext"==this.$$(a).name&&this._showDateForm(a);break;case"done":if(this._isFormCalendarZoomed)this.$$("formCalendar").selectDate(this.$$("formCalendar").config.date,!0),this._isFormCalendarZoomed=!1;else{var n=this.dateField.getValue(),r=this.$$("formCalendar").getValue();this.$$(n).setValue(r),this._setDefaultDates(),this.$$("views").back(),this.$$("editForm").validate()}break;case"allDay":this._setAllDay()}}),this.attachEvent("onAfterTabClick",function(e,t){this.$$(t).show()}),this.attachEvent("onBeforeTabClick",function(e,t){return this._confirmViewChange(t)})},readonly_setter:function(e){return this.$$("add")&&(e?(this.$$("bottomBar").showBatch("readonly"),this.$$("edit").hide(),this.$$("delete").hide()):(this.$$("bottomBar").showBatch("default"),this.$$("edit").show(),this.$$("delete").show())),e},_clearNoEventsStyle:function(){this.dataCount()?this.$view.className=this.$view.className.replace(RegExp(this.type.cssNoEvents,"g"),""):this.$view.className+=" "+this.type.cssNoEvents},_saveEvent:function(){if(this.$$("editForm").validate()){if(this.config.editEvent)this.$$("editForm").save();else{var e=this.$$("editForm").getValues();e.id=webix.uid(),e.details&&""===this._trim(e.text)&&""!==this._trim(e.details)&&(e.text=e.details),this.add(e),this.setCursor(e.id)}this.setDate(),this.$$("views").back()}},_deleteEvent:function(){var e=this;webix.confirm({height:scheduler.xy.confirm_height,width:scheduler.xy.confirm_width,title:t.icon_delete,text:t.confirm_deleting,callback:function(t){t&&(e.remove(e.getCursor()),e.setDate(),e.$$("views").back(1))},ok:t.icon_yes,cancel:t.icon_no,css:"confirm",header:!1})},_addEvent:function(){this.define("editEvent",!1),this.$$("form").show(),this.$$("editForm").clear(),this.$$("editForm").clearValidation(),this.$$("editForm").setValues(a.new_event_data.call(this)),this._setDefaultDates()},eventDefaultDate:function(){},_editEvent:function(){this.$$("delete")&&this.$$("delete").show(),this.define("editEvent",!0),this.$$("form").show(),this.$$("rec_type")&&this.$$("rec_type").setValue(this.$$("rec_type").getValue(),!0),this._setDefaultDates()},_confirmViewChange:function(e){if("form"==this.innerId(this.$$("views").getActiveId())){var a=this;return"today"!=e&&webix.confirm({height:scheduler.xy.confirm_height,width:scheduler.xy.confirm_width,title:t.icon_close,text:t.confirm_closing,callback:function(t){t&&(a.$$(e).show(),a.$$("buttons").setValue(e))},labelOk:t.icon_yes,labelCancel:t.icon_no,css:"confirm"}),!1}return!0},_showDateForm:function(e){this.dateField.setValue(e),this.$$("editForm").elements.allDay&&this.$$("formCalendar").define("timepicker",!this.$$("editForm").elements.allDay.getValue()),this.$$("formdate").show(),webix.delay(function(){this.$$("formCalendar").resize(),this.$$("formCalendar").selectDate(webix.Date.copy(this.$$(e).getValue()),!0)},this)},_checkAllDay:function(e){return e.valueOf()==webix.Date.datePart(e,!0).valueOf()},_setAllDay:function(){for(var e="1"==this.$$("allDay").getValue()?webix.i18n.formAllDayFormatStr:webix.i18n.formDateStr,t=this.$$("editForm").elements,a=[this.$$("start_date"),this.$$("end_date")],i=0;i<2;i++)a[i].config.dateFormatStr=e,1!=t.allDay.getValue()&&a[i].setValue(this._event_date[i],!0);if(1==t.allDay.getValue()){a[0].setValue(webix.Date.datePart(this._event_date[0],!0),!0);var n=webix.Date.datePart(this._event_date[1],!0);n.valueOf()<=a[0].getValue().valueOf()&&(n=webix.Date.add(n,1,"day",!0)),a[1].setValue(n,!0)}},_setDefaultDates:function(){this._event_date=[];var e=this.$$("editForm").elements;this._event_date[0]=this.$$("start_date").getValue(),this._event_date[1]=this.$$("end_date").getValue();var t=this._checkAllDay(this._event_date[0])&&this._checkAllDay(this._event_date[1])&&this._event_date[1].valueOf()>this._event_date[0].valueOf()?1:0;if(e.allDay){e.allDay.setValue(t);for(var a=e.allDay.getValue()?webix.i18n.formAllDayFormatStr:webix.i18n.formDateStr,i=[this.$$("start_date"),this.$$("end_date")],n=0;n<2;n++)i[n].config.dateFormatStr=a,i[n].setValue(this._event_date[n],!0)}},_trim:function(e){return e=(e=e.replace(/^ */g,"")).replace(/ *$/g,"")},setLoadMode:function(e){"all"==e&&(e=""),this._load_mode=e},_loaded_ranges:{},load:function(e){this._load_url=e;var t=arguments;if(this._load_mode&&"string"==typeof e){var a;e+=(-1==e.indexOf("?")?"?":"&")+"timeshift="+(new Date).getTimezoneOffset();var i=this.coreData.getValue(),n=webix.i18n.loadDateFormatStr;a=i=webix.Date[this._load_mode+"Start"](new Date(i.valueOf())),a=webix.Date.add(a,1,this._load_mode,!0),this._loaded_ranges[n(i)]&&(i=webix.Date.add(i,1,this._load_mode,!0));var r=a;do{a=r,r=webix.Date.add(a,-1,this._load_mode,!0)}while(r>i&&this._loaded_ranges[n(r)]);if(a<=i)return!1;for(t[0]=e+"&from="+n(i)+"&to="+n(a);i<a;)this._loaded_ranges[n(i)]=!0,i=webix.Date.add(i,1,this._load_mode,!0)}webix.DataLoader.prototype.load.apply(this,t)}},webix.IdSpace,webix.DataLoader,webix.ui.layout,webix.EventSystem,webix.Settings)}),n=scheduler.locale.labels,r=scheduler.xy,l=scheduler.config,s=scheduler.templates,webix.attachEvent("onAfterSchedulerInit",function(e){if(!l.recurring)return!1;webix.delay(function(){e.$$("editForm").define("dataFeed",function(e){delete(e=webix.copy(this.getTopParentView().getItem(e))).id,e.rec_type&&(e.endRepeat=e.end_date,e.end_date=new Date(e.start_date.valueOf()+1e3*e.event_length)),this.setValues(e)}),e.$$("editForm").getValueBase=e.$$("editForm").getValues,e.$$("editForm").getValues=function(){var e=this.getValueBase();return e.rec_type&&(e.event_length=Math.round((e.end_date-e.start_date)/1e3),e.end_date=e.endRepeat||e.end_date),e}}),e.getEventsBase=e.getEvents,e.getEvents=function(e,t){t=t||webix.Date.add(e,1,"month",!0);for(var a=this.getEventsBase(e,t),i=[],n=0;n<a.length;n++)a[n].rec_type?this.repeat_date(a[n],i,e,t):i.push(a[n]);return i.sort(function(e,t){return(e=e.start_date)>(t=t.start_date)?1:e<t?-1:0}),i},e._saveEventBase=e._saveEvent,e._saveEvent=function(){if(!this.config.editEvent&&this.$$("editForm").validate()){var e=this.$$("editForm").getValues();if(e.event_pid)return e.id=webix.uid(),e.details&&""===this._trim(e.text)&&""!==this._trim(e.details)&&(e.text=e.details),e.event_length=e.start_date.valueOf()/1e3,this._add_rec_marker(e,e.start_date.valueOf()),this.add(e),this.setCursor(e.id),this.setDate(),this.$$("views").back(),!0}this._saveEventBase.call(this)},e._editEventBase=e._editEvent,e._editEvent=function(){var t=this.getItem(this.getCursor());(t.rec_type||t.event_pid)&&l.recurring_dialogs?webix.rec_dialog({height:r.confirm_height,width:r.confirm_width,message:n.recurring.edit_message,callback:function(a){1==a?(t.event_pid&&e.setCursor(t.event_pid),e._editEventBase.call(e)):2==a&&e._applyRecExeption("edit")},labelSeries:n.recurring.edit_series,labelEvent:n.recurring.edit_occurrence,labelCancel:n.icon_cancel}):e._editEventBase.call(this)},e._deleteEventBase=e._deleteEvent,e._deleteEvent=function(){var t=this.getItem(this.getCursor());(t.rec_type||t.event_pid)&&l.recurring_dialogs?webix.rec_dialog({height:r.confirm_height,width:r.confirm_width,message:n.recurring.delete_message,callback:function(t){1==t?(e.remove(e.getCursor()),e.setDate(),e.$$("views").back(1)):2==t&&e._applyRecExeption("remove")},labelSeries:n.recurring.delete_series,labelEvent:n.recurring.delete_occurrence,labelCancel:n.icon_cancel}):e._deleteEventBase.call(this)},e._applyRecExeption=function(t){var a,i;if("edit"==t)if((a=webix.copy(this.getItem(this.getCursor()))).rec_type){if(this.define("editEvent",!1),this.$$("rec_type")&&!this.$$("rec_type").config.hidden&&(this._recTypeState="hide"),this.$$("form").show(),this.$$("editForm").clear(),a.event_pid=a.id,!(i=this._last_selected)&&!i[1])return e._editEventBase.call(this);a.start_date=new Date(1e3*i[1]),a.end_date=new Date(1e3*i[1]+1e3*a.event_length),delete a.id,a.rec_type=a.rec_pattern="",a.end_date=new Date(a.start_date.valueOf()+1e3*a.event_length),this.$$("editForm").setValues(a),this._setDefaultDates()}else e._editEventBase.call(this);else if("remove"==t){if((a=webix.copy(this.getItem(this.getCursor()))).event_pid=a.id,!(i=this._last_selected)||!i[1])return;a.start_date=new Date(1e3*i[1]),a.end_date=new Date(1e3*i[1]+1e3*a.event_length),a.id=webix.uid(),a.rec_type=a.rec_pattern="none",a.end_date=new Date(a.start_date.valueOf()+1e3*a.event_length),a.event_length=a.start_date.valueOf()/1e3,this._add_rec_marker(a,a.start_date.valueOf()),this.add(a),this.setDate(),this.$$("views").back()}},e._rec_markers={},e._rec_markers_pull={},e._add_rec_marker=function(e,t){e._pid_time=t,this._rec_markers[e.id]=e,this._rec_markers_pull[e.event_pid]||(this._rec_markers_pull[e.event_pid]={}),this._rec_markers_pull[e.event_pid][t]=e},e._get_rec_marker=function(e,t){var a=this._rec_markers_pull[t];return a?a[e]:null},e._get_rec_markers=function(e){return this._rec_markers_pull[e]||[]},e.data.scheme({$init:function(t){"string"==typeof t.start_date&&(t.start_date=webix.i18n.fullDateFormatDate(t.start_date)),"string"==typeof t.end_date&&(t.end_date=webix.i18n.fullDateFormatDate(t.end_date)),t.event_pid&&e._add_rec_marker(t,1e3*t.event_length)},$serialize:function(e){var t={};return t.start_date=webix.i18n.fullDateFormatStr(webix.Date.copy(e.start_date)),t.end_date=webix.i18n.fullDateFormatStr(webix.Date.copy(e.end_date)),webix.extend(t,e),t}}),e.transponse_size={day:1,week:7,month:1,year:12},e.day_week=function(e,t,a){e.setDate(1),a=7*(a-1);var i=e.getDay(),n=(7==t?0:1*t)+a-i+1;e.setDate(n<=a?n+7:n)},e.transpose_day_week=function(t,a,i,n,r){for(var l=(t.getDay()||(webix.Date.startOnMonday?7:0))-i,s=0;s<a.length;s++)if(a[s]>l)return t.setDate(t.getDate()+1*a[s]-l-(n?i:r));e.transpose_day_week(t,a,i+n,null,i)},e.transpose_type=function(t){var a="transpose_"+t;if(!webix.Date[a]){var i=t.split("_"),n=e.transponse_size[i[0]]*i[1];if("day"==i[0]||"week"==i[0]){var r=null;if(i[4]&&(r=i[4].split(","),webix.Date.startOnMonday)){for(var l=0;l<r.length;l++)r[l]=1*r[l]||7;r.sort()}webix.Date[a]=function(t,a){var i=Math.floor((a.valueOf()-t.valueOf())/(864e5*n));i>0&&t.setDate(t.getDate()+i*n),r&&e.transpose_day_week(t,r,1,n)},webix.Date.add[t]=function(t,a){if(r)for(var i=0;i<a;i++)e.transpose_day_week(t,r,0,n);else t.setDate(t.getDate()+a*n);return t}}else"month"!=i[0]&&"year"!=i[0]||(webix.Date[a]=function(t,a){var r=Math.ceil((12*a.getFullYear()+1*a.getMonth()-(12*t.getFullYear()+1*t.getMonth()))/n);r>=0&&t.setMonth(t.getMonth()+r*n),i[3]&&e.day_week(t,i[2],i[3])},webix.Date.add[t]=function(t,a){return t.setMonth(t.getMonth()+a*n),i[3]&&e.day_week(t,i[2],i[3]),t})}},e.data.attachEvent("onStoreUpdated",function(t,a,i){if("delete"==i||"update"==i||"insert"==i&&!a.rec_type&&a.event_pid){this.blockEvent();var n=e._get_rec_markers(t);for(var r in e._rec_markers_pull[t]=null,n)n.hasOwnProperty(r)&&(t=n[r].id,this.getItem(t)&&this.remove(t));this.unblockEvent()}}),e.repeat_date=function(t,a,i,n){if("none"!=t.rec_type){var r=new Date(t.start_date.valueOf());for(t.rec_pattern=t.rec_type.split("#")[0],e.transpose_type(t.rec_pattern),webix.Date["transpose_"+t.rec_pattern](r,i);r<t.start_date||r.valueOf()+1e3*t.event_length<=i.valueOf();)r=webix.Date.add(r,1,t.rec_pattern,!0);for(;r<n&&r<t.end_date;){if(!this._get_rec_marker(r.valueOf(),t.id)){var l=new Date(r.valueOf()+1e3*t.event_length),s=webix.copy(t);s.text=t.text,s.start_date=r,s.event_pid=t.id,s.id=t.id+"#"+Math.ceil(r.valueOf()/1e3),s.end_date=l;var o=s.start_date.getTimezoneOffset()-s.end_date.getTimezoneOffset();o&&(s.end_date=o>0?new Date(r.valueOf()+1e3*t.event_length-60*o*1e3):new Date(s.end_date.valueOf()+60*o*1e3)),a.push(s)}r=webix.Date.add(r,1,t.rec_pattern,!0)}}}}),webix.attachEvent("onBeforeSchedulerInit",function(){if(!l.recurring)return!0;l.form||(l.form=[{view:"text",label:n.label_event,name:"text",labelWidth:90},{view:"datetext",label:n.label_start,id:"start_date",name:"start_date",dateFormat:l.form_date,labelWidth:90},{view:"datetext",label:n.label_end,id:"end_date",name:"end_date",dateFormat:l.form_date,labelWidth:90},{view:"checkbox",id:"allDay",name:"allDay",label:n.label_allday,value:0,labelWidth:100},{view:"rectext",label:n.recurring.repeat,id:"rec_type",name:"rec_type",readonly:!0,labelWidth:90},{view:"textarea",label:n.label_details,id:"details",name:"details",height:110,labelWidth:90},{view:"text",hidden:!0,id:"event_length",name:"event_length"}]),l.recurring_bar||(l.recurring_bar=[{view:"label",width:r.icon_cancel,id:"recCancel",name:"recCancel",css:"cancel",align:"center",label:n.icon_cancel,batch:"default"},{view:"label",width:r.icon_cancel,id:"recEndCancel",name:"recEndCancel",css:"cancel",align:"center",label:n.icon_cancel,batch:"endRepeat"},{},{view:"button",width:r.icon_done,id:"recDone",name:"recDone",align:"right",label:n.icon_done,batch:"default"},{view:"button",width:r.icon_done,id:"recDone2",name:"recDone2",align:"right",label:n.icon_done,batch:"other"},{view:"button",width:r.icon_done,id:"recEndDone",name:"recEndDone",align:"right",label:n.icon_done,batch:"endRepeat"}]),l.recurring_views_list||(l.recurring_views_list=[{id:"none",value:n.recurring.none,readonly:!0},{id:"daily",value:n.recurring.daily},{id:"weekly",value:n.recurring.weekly},{id:"monthly",value:n.recurring.monthly},{id:"yearly",value:n.recurring.yearly}]),scheduler.templates.rec_list_item||(scheduler.templates.rec_list_item=function(e){return e.value+(e.readonly?"":"<div class='webix_arrow_icon'></div>")}),l.rec_init_form||(l.rec_init_form=[{height:10},{view:"reclist",id:"recList",autoheight:!0,scroll:!1,select:!0,css:"rec_list",value:"none",template:scheduler.templates.rec_list_item,datatype:"json",data:l.recurring_views_list,labelWidth:100},{maxHeight:42},{view:"endrec",id:"endRepeat",name:"endRepeat",labelWidth:r.recurring.label_end_repeat,label:n.recurring.end_repeat},{}]),l.end_repeat_form||(l.end_repeat_form=[{type:"clean",paddingX:10,paddingY:5,cols:[{view:"radio",css:"webix_endby_radio",vertical:!0,id:"endBy",width:290,labelWidth:r.recurring.label_end_by,height:80,options:[{value:n.recurring.endless_repeat,id:"0"},{value:n.recurring.end_repeat_label,id:"1"}]},{}]},{view:"calendar",id:"endByDate",width:0,css:"end_rep_calendar",icons:!1},{}]),l.daily_form||(l.daily_form=[{type:"clean",css:"webix_rec_counter",cols:[{view:"label",label:n.recurring.every,width:r.recurring.label_every},{view:"counter",id:"dayCount",name:"dayCount",value:1,width:125},{view:"label",label:n.recurring.day}]},{}]),s.selected_event_base=s.selected_event,s.selected_event=function(e,t){if(e.rec_type){var a=t.getTopParentView()._last_selected;if(!a||!a[1])return s.selected_event_base(e);var i=e.start_date,n=e.end_date;e.start_date=new Date(1e3*a[1]),e.end_date=new Date(1e3*a[1]+1e3*e.event_length);var r=s.selected_event_base(e);return e.start_date=i,e.end_date=n,r}return s.selected_event_base(e)},l.weekly_form||(l.weekly_form=[{height:10},{type:"clean",css:"webix_rec_counter",paddingX:8,cols:[{view:"label",borderless:!0,label:n.recurring.every,width:r.recurring.label_every},{view:"counter",id:"weekCount",name:"weekCount",value:1,width:125},{view:"label",label:n.recurring.week}]},{view:"weeklist",id:"weekDays",name:"weekDays"},{}]);for(var e={},t=1;t<32;t++)e[t]=t;scheduler.templates.rec_month_d||(scheduler.templates.rec_month_d=function(){return"<div class='radio'><div class='on'></div></div><div class='text'>"+n.recurring.month_day+"</div>"}),scheduler.templates.rec_month_w||(scheduler.templates.rec_month_w=function(){return"<div class='radio'><div class='on'></div></div><div class='text'>"+n.recurring.week_day+"</div>"}),scheduler.templates.rec_month_d_blured||(scheduler.templates.rec_month_d_blured=function(){return"<div class='radio blured'></div><div class='text'>"+n.recurring.month_day+"</div>"}),scheduler.templates.rec_month_w_blured||(scheduler.templates.rec_month_w_blured=function(){return"<div class='radio blured'></div><div class='text'>"+n.recurring.week_day+"</div>"}),l.week_day_counters||(l.week_day_counters=[{id:1,value:n.recurring.counters[0]},{id:2,value:n.recurring.counters[1]},{id:3,value:n.recurring.counters[2]},{id:4,value:n.recurring.counters[3]},{id:5,value:n.recurring.counters[4]}]),l.week_day_labels||(l.week_day_labels=[{id:1,value:webix.i18n.calendar.dayFull[1]},{id:2,value:webix.i18n.calendar.dayFull[2]},{id:3,value:webix.i18n.calendar.dayFull[3]},{id:4,value:webix.i18n.calendar.dayFull[4]},{id:5,value:webix.i18n.calendar.dayFull[5]},{id:6,value:webix.i18n.calendar.dayFull[6]},{id:7,value:webix.i18n.calendar.dayFull[0]}]),l.monthly_form||(l.monthly_form=[{type:"clean",paddingX:10,cols:[{view:"label",label:n.recurring.every,width:r.recurring.label_every},{view:"counter",id:"monthCount",name:"monthCount",value:1,width:125},{view:"label",label:n.recurring.month},{view:"text",hidden:!0,name:"monthType",value:"Day",width:1}]},{view:"accordion",id:"monthTypeSelect",rows:[{headerAltHeight:50,headerHeight:50,id:"typeDayM",header:scheduler.templates.rec_month_d,headerAlt:scheduler.templates.rec_month_d_blured,body:{view:"datecells",id:"monthDayM",name:"monthDayM",data:e}},{headerAltHeight:50,headerHeight:50,id:"typeWeekM",header:scheduler.templates.rec_month_w,headerAlt:scheduler.templates.rec_month_w_blured,collapsed:!0,body:{type:"clean",rows:[{height:10},{type:"clean",paddingX:10,cols:[{view:"select",value:1,id:"weekCountM",name:"weekCountM",css:"",options:l.week_day_counters},{view:"select",value:1,id:"weekDayM",name:"weekDayM",css:"",options:l.week_day_labels}]},{}]}}]}]),l.year_months||(l.year_months=scheduler.locale.date?scheduler.locale.date.month_short:webix.i18n.calendar.monthShort),l.yearly_form||(l.yearly_form=[{type:"clean",cols:[{view:"label",label:n.recurring.every,width:r.recurring.label_every},{view:"counter",id:"yearCount",name:"yearCount",value:1,width:125},{view:"label",label:n.recurring.year}]},{view:"datecells",id:"monthDayY",borderless:!0,data:l.year_months,x_count:4,height:130},{view:"checkbox",label:n.recurring.week_day,id:"typeWeekY",name:"typeWeekY",labelWidth:250,value:1},{id:"yearWeekRow",type:"clean",cols:[{view:"select",value:1,id:"weekCountY",name:"weekCountY",options:l.week_day_counters},{view:"select",value:1,id:"weekDayY",name:"weekDayY",options:l.week_day_labels}]},{}]),l.recurring_views||(l.recurring_views=[{id:"recForm",view:"form",css:"webix_rec_form",padding:0,scroll:!1,elements:l.rec_init_form},{id:"endRepeatForm",view:"form",type:"clean",elements:l.end_repeat_form},{id:"daily",view:"daily",elements:l.daily_form},{id:"weekly",view:"weekly",type:"clean",elements:l.weekly_form},{id:"monthly",view:"monthly",elements:l.monthly_form,margin:10},{id:"yearly",view:"yearly",padding:10,margin:10,type:"clean",elements:l.yearly_form}]),l.views.push({view:"recurring",id:"recurring"}),webix.protoUI({name:"recurring",defaults:{padding:0,rows:[{view:"toolbar",id:"reccuringBar",css:"webix_subbar",elements:l.recurring_bar,visibleBatch:"default"},{id:"recViews",animate:!1,cells:l.recurring_views}],typeToId:{day:"daily",week:"weekly",month:"monthly",year:"yearly"},endlessDate:l.endless_date},$init:function(){this.name="Recurring",this.$view.className+=" webix_recurring",this.$ready.push(this._setEvents)},_setEvents:function(){var e={};for(var t in this.config.typeToId)e[this.config.typeToId[t]]=t;this.define("idToType",e),webix.delay(function(){var e=this.getTopParentView();e.$$("rec_type").attachEvent("onItemClick",this._showRecViewsList),e.$$("reccuringBar").attachEvent("onItemClick",webix.bind(function(e){switch(e=this.innerId(e)){case"recDone2":case"recEndCancel":this.$$("recViews").back(),this.$$("reccuringBar").showBatch("default");break;case"recCancel":this.$$("views").back();break;case"recDone":this.$$("recurring")._applyRecurrence(),this.$$("views").back();break;case"recEndDone":var t;t="1"==this.$$("endBy").getValue()?this.$$("endByDate").getValue():this.$$("recurring").config.endlessDate,this.$$("endRepeat").setValue(t),this.$$("recViews").back(),this.$$("reccuringBar").showBatch("default")}},e)),e.$$("recList").attachEvent("onItemClick",webix.bind(this._showRecView,e)),e.$$("endRepeat").attachEvent("onItemClick",webix.bind(function(){this._showRecView.call(e,"endRepeatForm"),e.$$("reccuringBar").showBatch("endRepeat"),this._setEndDate()},this)),e.$$("typeWeekY")&&e.$$("typeWeekY").attachEvent("onItemClick",function(){this.getValue()?e.$$("yearWeekRow").show():e.$$("yearWeekRow").hide()}),e.$$("endBy")&&e.$$("endBy").attachEvent("onItemClick",function(){"1"==this.getValue()?e.$$("endByDate").show():e.$$("endByDate").hide()}),e.$$("editForm").attachEvent("onItemClick",webix.bind(function(e){"end_date"==(e=this.innerId(e))&&this._showDateForm(e)},e)),e.$$("weekly").elements.weekDays=e.$$("weekDays"),e.$$("monthly").elements.monthDayM=e.$$("monthDayM"),e.$$("yearly").elements.monthDayY=e.$$("monthDayY"),e.$$("editForm").elements.endRepeat=e.$$("endRepeat"),e.$$("views").attachEvent("onViewChange",function(t,a){e._recTypeState&&e.$$("form").config.id==a&&("hide"==e._recTypeState?(e.$$("rec_type").hide(),e._recTypeState="show"):"show"==e._recTypeState&&e.$$("rec_type").show())})},this)},_showRecViewsList:function(){var e=this.getTopParentView();e.$$("recurring").show(),e.$$("recForm")&&(e.$$("recForm").show(),e.$$("recurring").setValue(),e.$$("endRepeat").setValue(e.$$("endRepeat").config.value))},_showRecView:function(e){this.$$(e)&&(this.$$(e).show(),this.$$("reccuringBar").showBatch("other")),this.$$("endRepeat").getValue()||this.$$("endRepeat").setValue(this.$$("recurring").config.endlessDate)},setValue:function(){var e,t=this.getTopParentView(),a=(t.$$("rec_type").getValue()||"_____").split("_"),i=t.$$("recurring").config;t.$$("recList").setValue(a[0]&&""!==a[0]?i.typeToId[a[0]]:"none");var n=t.$$("start_date").getValue();for(var r in i.typeToId)r==a[0]?(a.push(n),e=webix.copy(a)):e=[r,1,"","","",n],t.$$(i.typeToId[r]).setValue(e)},getValue:function(){var e=this.getTopParentView(),t=e.$$("recList").getSelectedId();return"none"==t?["","","","","",""]:e.$$(t).getValue()},_applyRecurrence:function(){var e=this.getTopParentView(),t=this.getValue(),a=e.$$("start_date").getValue(),i=e.$$("end_date").getValue().valueOf()-a.valueOf();if(e.$$("event_length").setValue(i/1e3),!t[0])return e.$$("endRepeat").setValue(e.$$("end_date").getValue()),e.$$("rec_type").setValue(""),void e.$$("event_length").setValue("");"week"==t[0]?a=webix.Date.add(a,-1*(a.getDay()+6)%7,"day",!0):"month"==t[0]?t[5]&&a.setDate(t[5]):"year"==t[0]&&t[5]&&a.setMonth(t[5]),e.$$("start_date").setValue(a),e.$$("end_date").setValue(new Date(a.valueOf()+i)),t.pop();var n="";"0"==e.$$("endBy").getValue()&&(n="no"),e.$$("rec_type").setValue(t.join("_")+"#"+n)},_setEndDate:function(){var e=this.getTopParentView(),t=e.$$("editForm").getValues().end_date;t.valueOf()==this.config.endlessDate.valueOf()?(e.$$("endBy").setValue("0"),e.$$("endByDate").setValue(scheduler.config.end_by||webix.Date.add(e.$$("end_date").getValue(),1,"year",!0),!0)):(e.$$("endBy").setValue("1"),e.$$("endByDate").define("minDate",t),e.$$("endByDate").setValue(t)),this._setEndByVisibility()},_setEndByVisibility:function(){var e=this.getTopParentView();"1"==e.$$("endBy").getValue()?e.$$("endByDate").show():e.$$("endByDate").hide()}},webix.DataLoader,webix.ui.form,webix.EventSystem,webix.Settings)})},function(e,t){webix.protoUI({name:"rec_dialog",defaults:{height:210,css:"webix_scheduler dialog",head:!1,body:{type:"clean",rows:[{id:"webix_confirm_message",template:"<div class='webix_dialog_text'>#text#</div>",data:{text:"You have forgot to define the text :) "}},{height:44,view:"button",label:"Series",click:function(){this.getParentView().getParentView()._callback(1)}},{height:44,view:"button",label:"Occurrence",click:function(){this.getParentView().getParentView()._callback(2)}},{height:44,view:"button",css:"cancel",label:"Cancel",click:function(){this.getParentView().getParentView()._callback(!1)}}]}},labelSeries_setter:function(e){var t=this._body_cell._cells[1];t.config.label=e,t.render()},labelEvent_setter:function(e){var t=this._body_cell._cells[2];t.config.label=e,t.render()},labelCancel_setter:function(e){var t=this._body_cell._cells[3];t.config.label=e,t.render()}},webix.ui.alert),webix.rec_dialog=webix.single(webix.ui.rec_dialog)},function(e,t){var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};webix.protoUI({name:"yearly",defaults:{css:"webix_yearly"},setValue:function(e){if("object"==(void 0===e?"undefined":a(e))&&"year"==e[0]){var t=this.getTopParentView();e[1]||""!==e[1]||(e[1]=1),e[2]&&""!==e[2]?t.$$("typeWeekY").setValue(1):(t.$$("typeWeekY").setValue(0),e[2]=(e[5].getDay()+6)%7+1,e[3]=Math.ceil(e[5].getDate()/7)),t.$$("typeWeekY").callEvent("onItemClick",[]),this.setValues({yearCount:e[1],weekDayY:e[2],weekCountY:e[3],monthDayY:e[5].getMonth()})}},getValue:function(){var e=this.getValues(),t=["year",e.yearCount,"","","",""];return this.getTopParentView().$$("typeWeekY").getValue()&&(t[2]=e.weekDayY,t[3]=e.weekCountY),t[5]=e.monthDayY,t}},webix.ui.form)},function(e,t){var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};webix.protoUI({name:"monthly",defaults:{css:"webix_monthly"},setValue:function(e){if("object"==(void 0===e?"undefined":a(e))&&"month"==e[0]){var t=this.getTopParentView();e[1]||""!==e[1]||(e[1]=1),e[2]&&""!==e[2]?t.$$("typeWeekM").expand():(e[2]=(e[5].getDay()+6)%7+1,e[3]=Math.ceil(e[5].getDate()/7)),this.setValues({monthCount:e[1],weekDayM:e[2],weekCountM:e[3],monthDayM:e[5].getDate()})}},getValue:function(){var e=this.getValues(),t=["month",e.monthCount,"","","",""];return this.getTopParentView().$$("typeDayM").config.collapsed?(t[2]=e.weekDayM,t[3]=e.weekCountM):t[5]=e.monthDayM,t}},webix.ui.form)},function(e,t){var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};webix.protoUI({name:"weeklist",defaults:{css:"webix_weeklist",elementsConfig:{labelWidth:2},rows:[{view:"checkbox",name:1,id:1,labelRight:webix.i18n.calendar.dayFull[1]},{view:"checkbox",name:2,id:2,labelRight:webix.i18n.calendar.dayFull[2]},{view:"checkbox",name:3,id:3,labelRight:webix.i18n.calendar.dayFull[3]},{view:"checkbox",name:4,id:4,labelRight:webix.i18n.calendar.dayFull[4]},{view:"checkbox",name:5,id:5,labelRight:webix.i18n.calendar.dayFull[5]},{view:"checkbox",name:6,id:6,labelRight:webix.i18n.calendar.dayFull[6]},{view:"checkbox",name:7,id:7,labelRight:webix.i18n.calendar.dayFull[0]}]},getValue:function(){var e=this.getValues(),t=[];for(var a in e)e[a]&&t.push(a);return t.join()},setValue:function(e){for(var t={},i=1;i<8;i++)t[i]=0;"object"!=(void 0===e?"undefined":a(e))&&(e=e.split(","));for(var n=0;n<e.length;n++)t[parseInt(e[n],10)]=1;this.setValues(t)}},webix.MouseEvents,webix.EventSystem,webix.ui.form)},function(e,t){var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};webix.protoUI({name:"weekly",setValue:function(e){"object"==(void 0===e?"undefined":a(e))&&"week"==e[0]&&(e[1]||""!==e[1]||(e[1]=1),e[4]&&""!==e[4]||(e[4]=(e[5].getDay()+6)%7+1),this.setValues({weekCount:e[1],weekDays:""+e[4]}))},getValue:function(){var e=this.getValues();return e.weekDays||(e.weekDays=1),["week",e.weekCount,"","",e.weekDays,""]}},webix.ui.form)},function(e,t){var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};webix.protoUI({name:"daily",setValue:function(e){"object"==(void 0===e?"undefined":a(e))&&"day"==e[0]&&(e[1]&&""!==e[1]||(e[1]=1),this.setValues({dayCount:e[1]}))},getValue:function(){return["day",this.getValues().dayCount,"","","",""]}},webix.ui.form)},function(e,t){webix.protoUI({name:"reclist",defaults:{},$init:function(){this.$view.className+=" webix_reclist"},setValue:function(e){this.getItem(e)&&this.select(e)},getValue:function(){return this.getSelected()}},webix.ui.list)},function(e,t){var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};webix.protoUI({name:"endrec",setValue:function(e){var t=!1,a=this.config.value;a==e?t=!0:this.config.value=e,this.getInputNode()&&this.$setValue(e),t||this.callEvent("onChange",[e,a])},$setValue:function(e){this.config.value=e||"";var t,i=this.getTopParentView().$$("recurring");"object"==(void 0===e?"undefined":a(e))&&(t=e.valueOf()==i.config.endlessDate.valueOf()?scheduler.locale.labels.recurring.never:(this.config.dateFormatStr||webix.i18n.dateFormatStr)(this.config.value)),this.config.text=this.getInputNode().innerHTML=t||this.config.value}},webix.ui.datetext)},function(e,t){webix.protoUI({name:"rectext",$setValue:function(e){this.config.value=e||"";var t="none",a=this.getTopParentView().$$("recurring"),i=this.config.value.split("_");""!==i[0]&&(t=a.config.typeToId[i[0]]),this.config.text=this.getInputNode().innerHTML=scheduler.locale.labels.recurring[t]}},webix.ui.datetext)},function(e,t){webix.protoUI({name:"datecells",defaults:{css:"webix_datecells",x_count:7,cellHeight:36},_id:"webix_d_c",$init:function(){this._dataobj=this.$view},on_click:{webix_cal_day_num:function(e,t){t&&this.define("activeCell",t)}},activeCell_setter:function(e){return this.config.activeCell=e,this.render(),e},render:function(){if(this.isVisible(this.config.id)){var e=1,t="<table cellspacing='0' cellpadding='0' class='webix_rec_table'><tbody>",a=this.config.data,i=this.$width/this.config.x_count;for(var n in a){var r="",l="webix_cal_day_num";r+=";height:"+this.config.cellHeight+"px;line-height:"+this.config.cellHeight+"px;",e%this.config.x_count==1&&(t+="<tr>"),t+="<td style='"+(i?"width:"+i+"px":"")+"'>",this.config.activeCell==n&&(l+=" webix_cal_selected_day"),t+="<div webix_d_c='"+n+"' class='"+l+"' style='"+r+"'>"+a[n]+"</div>",t+="</td>",e%this.config.x_count==0&&(t+="</tr>"),e++}t+="</tbody></table>",this.$view.innerHTML=t}},$setSize:function(e,t){webix.ui.view.prototype.$setSize.call(this,e,t)&&this.render()},setValue:function(e){this.define("activeCell",e)},getValue:function(){return this.config.activeCell}},webix.MouseEvents,webix.ui.view,webix.EventSystem)},function(e,t){webix.protoUI({name:"ariabutton",$cssName:"button",$renderInput:function(e){var t="class='webixtype_"+(e.type||"base")+"' ";return"<button type='button' aria-label='"+webix.template.escape(e.label||e.value)+"'"+t+"></button>"}},webix.ui.button)},function(e,t){webix.protoUI({name:"weekevents",on_click:{},render:function(e,t){this.isVisible(this.config.id)&&this.callEvent("onBeforeRender",[this.data])&&(this.units=null,this._htmlmap=null,this._setUnits(),this.units&&((t=this._getUnitRange()).length?this.$view.firstChild.innerHTML=t.map(this._toHTML,this).join(""):this.$view.firstChild.innerHTML="<div class='webix_noevents'>"+this.config.noEvents+"</div>"),this.callEvent("onAfterRender",[]))},_toHTML:function(e){var t=this.data.getMark(e.id,"webix_selected")?" webix_selected":"";return this.callEvent("onItemRender",[e]),e.$unit?this.type.templateStartHeader(e,this.type)+this.type.templateHeader.call(this,e.$unit)+this.type.templateEnd(e,this.type):this.type.templateStart(e,this.type,t)+(e.$template?this.type["template"+e.$template]:this.type.template)(e,this.type)+this.type.templateEnd(e,this.type)},_getUnitRange:function(){var e,t,a,i;for(a in e=[],this.units)for(e.push({$unit:a}),i=this.units[a],t=0;t<i.length;t++){var n=webix.extend({},i[t]);e.push(n)}return webix.toArray(e)},_setUnits:function(){var e=this.getTopParentView(),t=e.coreData.getValue(),a=webix.Date.weekStart(t),i=webix.Date.add(a,1,"week",!0);for(this.units={};a.valueOf()<i.valueOf();){var n=webix.Date.add(a,1,"day",!0),r=e._correctEventsDates(a,e.getEvents(a,n));r.length&&(this.units[a.valueOf()]=r),a=webix.Date.add(a,1,"day",!0)}},type:{headerHeight:28,margin:0,padding:0,aria:function(e,t,a){return" role='option'"+(a?" aria-selected='true' tabindex='0'":" tabindex='-1'")},templateHeader:function(e){var t=new Date(parseInt(e,10));return"<span class='webix_unit_header_inner"+(webix.Date.datePart(t).valueOf()==webix.Date.datePart(new Date).valueOf()?" current":"")+"'>"+webix.i18n.weekDateFormatStr(t)+"</span>"},templateStart:function(e,t,a){if(e.$unit)return t.templateStartHeader.apply(this,arguments);var i="webix_list_item webix_list_"+t.css+"_item"+(e.$selected?"_selected":"")+a,n="width:auto; height:"+t.height+"px; padding:"+t.padding+"px; margin:"+t.margin+"px; overflow:hidden;"+(t.layout&&"x"==t.layout?"float:left;":""),r=t.aria(e,t,a);return"<div webix_l_id='"+e.id+"' class='"+i+"' style='"+n+"' "+r+">"},templateStartHeader:function(e,t){var a="webix_unit_header webix_unit_"+t.css+"_header"+(e.$selected?"_selected":""),i="width:auto; height:"+t.headerHeight+"px; overflow:hidden;";return"<div webix_unit_id='"+e.$unit+"' class='"+a+"' style='"+i+"'>"}}},webix.ui.list)},function(e,t){var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};webix.protoUI({name:"datetext",defaults:{icon:"angle-right"},$renderIcon:function(){var e=this.config,t=e.aheight-2*e.inputPadding,a=(t-18)/2-1;return e.icon?"<span style=height:"+(t-a)+"px;padding-top:"+a+"px;' class='webix_input_icon  fa-"+e.icon+"'></span>":""},$init:function(){this.attachEvent("onAfterRender",webix.once(this._after_render,this))},_after_render:function(){webix.event(this.getInputNode(),"keydown",function(e){var t=e.which||e.keyCode;32!=t&&13!=t&&39!=t||webix.html.triggerEvent(document.activeElement,"MouseEvents","click")},this)},setValue:function(e,t){var a=this.config.value,i=!0;if(a==e&&(i=!1,!t))return!1;this.config.value=e,this.getInputNode()&&this.$setValue(e),i&&this.callEvent("onChange",[e,a])},$setValue:function(e){this.config.value=e||"";var t=this.config.dateFormatStr||webix.i18n.dateFormatStr;this.config.text=this.getInputNode().innerHTML="object"==a(this.config.value)?t(this.config.value):this.config.value},dateFormat_setter:function(e){return this.config.dateFormatStr=webix.Date.dateToStr(e),webix.Date.strToDate(e)},getValue:function(){return this.config.value||null},getInputNode:function(){return this.$view.getElementsByTagName("DIV")[1]}},webix.ui.richselect)},function(e,t){webix.protoUI({name:"dayevents",defaults:{hourFormat:"%H",hourClock:12,firstHour:0,lastHour:24,timeScaleWidth:25,minEventHeight:20,timeScaleHeight:40,scroll:!0,scaleBorder:1,eventOffset:5,separateShortEvents:!0,date:new Date},$init:function(e){this.name="DayEvents",this._dataobj=this.$view.firstChild,this._dataobj.style.position="relative",this.$view.className+=" webix_dayevents",this.data.provideApi(this,!0),this.data.attachEvent("onStoreUpdated",webix.bind(this.render,this)),window.scheduler&&(e.hourFormat=scheduler.config.scale_hour,e.timeScaleWidth=scheduler.xy.scale_width,e.minEventHeight=scheduler.xy.min_event_height,e.timeScaleHeight=2*scheduler.xy.scale_height,e.separateShortEvents=scheduler.config.separate_short_events)},render:function(){this.isVisible(this.config.id)&&!this.$blockRender&&this.callEvent("onBeforeRender",[this.data])&&(this._renderScale(),this.type.color=this.config.color,this.type.textColor=this.config.textColor,this._prepareEvents(),window.scheduler&&scheduler.templates&&(this.type.template=scheduler.templates.day_event,this.type.templateCss=scheduler.templates.event_class),this._dataobj.firstChild.innerHTML=this.data.getRange().map(this._toHTML,this).join(""),this._htmlmap=null,this.callEvent("onAfterRender",[]))},getItemNode:function(e){if(this._htmlmap)return this._htmlmap[e];this._htmlmap={};for(var t=this._dataobj.firstChild.childNodes,a=0;a<t.length;a++){var i=t[a].getAttribute(this._id);i&&(this._htmlmap[i]=t[a])}return this.getItemNode(e)},_toHTML:function(e){var t=this.data.getMark(e.id,"webix_selected")?" webix_selected":"";this.callEvent("onItemRender",[e]);var a=(e.$template?this.type["template"+e.$template]:this.type.template)(e,this.type,t);return this.type.templateStart(e,this.type,t)+a+this.type.templateEnd(e,this.type,t)},_renderScale:function(){for(var e="<div role='presentation'></div>",t=this.config.firstHour;t<this.config.lastHour;t++)e+=this.hourScaleItem(t);this._dataobj.innerHTML=e},on_click:{},hourScaleItem:function(e){var t=this.config.hourFormat,a=new Date;a.setHours(e),e=webix.Date.dateToStr(t)(a);var i="",n=this.config.timeScaleWidth,r=this.config.timeScaleHeight,l=Math.floor(this.config.timeScaleWidth),s=Math.floor(r/2),o=this.$width-this.config.scaleBorder-n;return i+="<div style='width: 100%; height:"+r+"px;' class='webix_dayevents_scale_item'>",i+="<div class='webix_dayevents_scale_hour' style='width:"+l+"px; height:"+r+"px;line-height:"+r+"px;'>"+e+"</div>",i+="<div class='webix_dayevents_scale_event'  style='width:"+o+"px'>",i+="<div class='webix_dayevents_scale_top' style='height:"+s+"px;width:"+o+"px'></div>",i+="</div>",i+="</div>"},type:{aria:function(e,t,a){return"role='option'"+(a?" aria-selected='true' tabindex='0'":" tabindex='-1'")},templateStart:webix.template("<div webix_l_id='#id#' {common.aria()} class='{common.classname()} {common.templateCss()}' style='left:#$left#px;top:#$top#px;width:#$width#px;height:#$height#px;padding:{common.padding}px;overflow:hidden; {common.templateColor()} ;'>"),template:"#text#",templateEnd:webix.template("</div>"),templateCss:webix.template(""),templateColor:function(e){return window.scheduler?scheduler.templates.day_event_style(e):""},classname:function(e,t,a){return"webix_dayevents_event_item"+a},padding:4},_prepareEvents:function(){var e,t,a,i,n,r,l,s=this.data.getRange(),o=[];for(this._minMappedDuration=Math.ceil(60*this.config.minEventHeight/(this.config.timeScaleHeight+1)),t=0;t<s.length;t++){for((e=s[t]).$inner=!1;o.length&&this._getEventEndDate(o[o.length-1]).valueOf()<=e.start_date.valueOf();)o.splice(o.length-1,1);for(l=!1,a=0;a<o.length;a++)if(this._getEventEndDate(o[a]).valueOf()<=e.start_date.valueOf()){l=!0,e.$sorder=o[a].$sorder,o.splice(a,1),e.$inner=!0;break}if(o.length&&(o[o.length-1].$inner=!0),!l)if(o.length)if(o.length<=o[o.length-1].$sorder){if(o[o.length-1].$sorder)for(a=0;a<o.length;a++){for(n=!1,i=0;i<o.length;i++)if(o[i].$sorder==a){n=!0;break}if(!n){e.$sorder=a;break}}else e.$sorder=0;e.$inner=!0}else{for(r=o[0].$sorder,a=1;a<o.length;a++)o[a].$sorder>r&&(r=o[a].$sorder);e.$sorder=r+1,e.$inner=!1}else e.$sorder=0;o.push(e),o.length>(o.max_count||0)&&(o.max_count=o.length)}for(var d=0;d<s.length;d++)s[d].$count=o.max_count,this._setPosition(s[d])},_setPosition:function(e){var t=this.config.date.getValue?this.config.date.getValue():this.config.date,a=webix.Date.copy(e.start_date),i=webix.Date.copy(e.end_date),n=a.getHours(),r=i.getHours();webix.Date.datePart(a,!0).valueOf()>webix.Date.datePart(i,!0).valueOf()&&(i=a),webix.Date.datePart(a,!0).valueOf()<webix.Date.datePart(t,!0).valueOf()&&(a=webix.Date.datePart(t)),webix.Date.datePart(i,!0).valueOf()>webix.Date.datePart(t,!0).valueOf()&&((i=webix.Date.datePart(t,!0)).setMinutes(0),i.setHours(this.config.lastHour)),(n<this.config.firstHour||r>=this.config.lastHour)&&(n<this.config.firstHour&&(a.setHours(this.config.firstHour),a.setMinutes(0)),r>=this.config.lastHour&&(i.setMinutes(0),i.setHours(this.config.lastHour)));var l=Math.floor((this.$width-this.config.timeScaleWidth-this.config.eventOffset)/e.$count);e.$left=e.$sorder*l+this.config.timeScaleWidth+this.config.eventOffset,e.$inner||(l*=e.$count-e.$sorder),e.$width=l-this.config.eventOffset-2*this.type.padding;var s=60*a.getHours()+a.getMinutes(),o=60*i.getHours()+i.getMinutes()||60*this.config.lastHour;e.$top=Math.round((s-60*this.config.firstHour)*(this.config.timeScaleHeight+1)/60),e.$height=Math.max(this.config.minEventHeight,(o-s)*(this.config.timeScaleHeight+1)/60-1)-2*this.type.padding},_getEventEndDate:function(e){var t=e.end_date;if(this.config.separateShortEvents){var a=(e.end_date-e.start_date)/6e4;a<this.config.minEventHeight&&(t=webix.Date.add(t,this._minMappedDuration-a,"minute",!0))}return t},$setSize:function(e,t){webix.ui.view.prototype.$setSize.call(this,e,t)&&this.render()}},webix.ui.list)},,function(e,t,a){}]);